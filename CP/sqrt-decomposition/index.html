
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://lto5.github.io/CP/sqrt-decomposition/">
      
      
        <link rel="prev" href="../dp-digit/">
      
      
        <link rel="next" href="../query-tree/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Chia căn và các biến thể - lto5's blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chia-can-va-cac-bien-the" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="lto5&#39;s blog" class="md-header__button md-logo" aria-label="lto5's blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            lto5's blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chia căn và các biến thể
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/lto5/lto5.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    lto5/lto5.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  Trang chủ

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../dp-digit/" class="md-tabs__link">
          
  
  
  CP

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="lto5&#39;s blog" class="md-nav__button md-logo" aria-label="lto5's blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    lto5's blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lto5/lto5.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    lto5/lto5.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Trang chủ
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Trang chủ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Giới thiệu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../navigation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nội dung
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    CP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            CP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dp-digit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quy hoạch động chữ số
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Chia căn và các biến thể
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Chia căn và các biến thể
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chia-block" class="md-nav__link">
    <span class="md-ellipsis">
      Chia block
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chia block">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inh-nghia" class="md-nav__link">
    <span class="md-ellipsis">
      Định nghĩa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chia-theo-truy-van" class="md-nav__link">
    <span class="md-ellipsis">
      Chia theo truy vấn
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chia theo truy vấn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gioi-thieu" class="md-nav__link">
    <span class="md-ellipsis">
      Giới thiệu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung_1" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chia-2-cach-lam" class="md-nav__link">
    <span class="md-ellipsis">
      Chia 2 cách làm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chia 2 cách làm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inh-nghia_1" class="md-nav__link">
    <span class="md-ellipsis">
      Định nghĩa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du_2" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung_2" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thuat-toan-mo" class="md-nav__link">
    <span class="md-ellipsis">
      Thuật toán Mo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Thuật toán Mo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#khong-cap-nhat" class="md-nav__link">
    <span class="md-ellipsis">
      Không cập nhật
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Không cập nhật">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mo-tren-cay" class="md-nav__link">
    <span class="md-ellipsis">
      Mo trên cây
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mo trên cây">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#truy-van-cay-con" class="md-nav__link">
    <span class="md-ellipsis">
      Truy vấn cây con
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#truy-van-uong-i" class="md-nav__link">
    <span class="md-ellipsis">
      Truy vấn đường đi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-toan-ap-dung" class="md-nav__link">
    <span class="md-ellipsis">
      Bài toán áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mot-so-thu-thuat-toi-uu" class="md-nav__link">
    <span class="md-ellipsis">
      Một số thủ thuật tối ưu
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Một số thủ thuật tối ưu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mot-cach-sap-xep-truy-van-khac" class="md-nav__link">
    <span class="md-ellipsis">
      Một cách sắp xếp truy vấn khác
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#khu-log" class="md-nav__link">
    <span class="md-ellipsis">
      Khử \(\log\)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#co-cap-nhat" class="md-nav__link">
    <span class="md-ellipsis">
      Có cập nhật
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Có cập nhật">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vi-du_3" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung_3" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xau" class="md-nav__link">
    <span class="md-ellipsis">
      Xâu
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Xâu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gioi-thieu_1" class="md-nav__link">
    <span class="md-ellipsis">
      Giới thiệu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du_4" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung_4" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baby-step-giant-step" class="md-nav__link">
    <span class="md-ellipsis">
      Baby step giant step
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Baby step giant step">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gioi-thieu_2" class="md-nav__link">
    <span class="md-ellipsis">
      Giới thiệu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du_5" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung_5" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tai-lieu-tham-khao" class="md-nav__link">
    <span class="md-ellipsis">
      Tài liệu tham khảo
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query-tree/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dựng cây truy vấn
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manacher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thuật toán Manacher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../offline-incremental-scc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Offline Incremental SCC
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chia-block" class="md-nav__link">
    <span class="md-ellipsis">
      Chia block
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chia block">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inh-nghia" class="md-nav__link">
    <span class="md-ellipsis">
      Định nghĩa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chia-theo-truy-van" class="md-nav__link">
    <span class="md-ellipsis">
      Chia theo truy vấn
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chia theo truy vấn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gioi-thieu" class="md-nav__link">
    <span class="md-ellipsis">
      Giới thiệu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung_1" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chia-2-cach-lam" class="md-nav__link">
    <span class="md-ellipsis">
      Chia 2 cách làm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chia 2 cách làm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inh-nghia_1" class="md-nav__link">
    <span class="md-ellipsis">
      Định nghĩa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du_2" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung_2" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thuat-toan-mo" class="md-nav__link">
    <span class="md-ellipsis">
      Thuật toán Mo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Thuật toán Mo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#khong-cap-nhat" class="md-nav__link">
    <span class="md-ellipsis">
      Không cập nhật
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Không cập nhật">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mo-tren-cay" class="md-nav__link">
    <span class="md-ellipsis">
      Mo trên cây
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mo trên cây">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#truy-van-cay-con" class="md-nav__link">
    <span class="md-ellipsis">
      Truy vấn cây con
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#truy-van-uong-i" class="md-nav__link">
    <span class="md-ellipsis">
      Truy vấn đường đi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-toan-ap-dung" class="md-nav__link">
    <span class="md-ellipsis">
      Bài toán áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mot-so-thu-thuat-toi-uu" class="md-nav__link">
    <span class="md-ellipsis">
      Một số thủ thuật tối ưu
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Một số thủ thuật tối ưu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mot-cach-sap-xep-truy-van-khac" class="md-nav__link">
    <span class="md-ellipsis">
      Một cách sắp xếp truy vấn khác
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#khu-log" class="md-nav__link">
    <span class="md-ellipsis">
      Khử \(\log\)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#co-cap-nhat" class="md-nav__link">
    <span class="md-ellipsis">
      Có cập nhật
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Có cập nhật">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vi-du_3" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung_3" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xau" class="md-nav__link">
    <span class="md-ellipsis">
      Xâu
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Xâu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gioi-thieu_1" class="md-nav__link">
    <span class="md-ellipsis">
      Giới thiệu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du_4" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung_4" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baby-step-giant-step" class="md-nav__link">
    <span class="md-ellipsis">
      Baby step giant step
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Baby step giant step">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gioi-thieu_2" class="md-nav__link">
    <span class="md-ellipsis">
      Giới thiệu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vi-du_5" class="md-nav__link">
    <span class="md-ellipsis">
      Ví dụ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bai-tap-ap-dung_5" class="md-nav__link">
    <span class="md-ellipsis">
      Bài tập áp dụng
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tai-lieu-tham-khao" class="md-nav__link">
    <span class="md-ellipsis">
      Tài liệu tham khảo
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="chia-can-va-cac-bien-the">Chia căn và các biến thể<a class="headerlink" href="#chia-can-va-cac-bien-the" title="Permanent link">&para;</a></h1>
<p><em>Bài được viết khi tác giả đang panic với môn TTHCM <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M464 256c0-114.9-93.1-208-208-208S48 141.1 48 256c0 41.8 12.3 80.7 33.6 113.3 8.2 44.7 47.3 78.6 94.3 78.7 24.7 10.3 51.7 16 80.1 16 114.9 0 208-93.1 208-208m-176 96c-5.5 0-10.9.6-16 1.8V352c0-16.2-4-31.5-11.1-44.9 8.7-2 17.8-3.1 27.1-3.1 40.2 0 75.7 19.8 97.5 50 7.7 10.8 5.3 25.8-5.5 33.5s-25.8 5.3-33.5-5.5c-13.1-18.2-34.4-30-58.5-30M0 256a256 256 0 1 1 512 0 256 256 0 1 1-512 0m176-80a32 32 0 1 1 0 64 32 32 0 1 1 0-64m128 32a32 32 0 1 1 64 0 32 32 0 1 1-64 0m-118.6 68.8c6.5 7.8 12.6 16.1 18.3 24.6 9 13.4 20.3 30.2 20.3 47.4 0 28.3-21.5 51.2-48 51.2s-48-22.9-48-51.2c0-17.2 11.2-34 20.3-47.4 5.7-8.5 11.9-16.7 18.3-24.6 2.4-2.9 5.7-4.8 9.4-4.8s7 1.9 9.4 4.8"/></svg></span></em></p>
<p>Trên VNOI đã có rất nhiều bài về chia căn (tới 2 blog và 2 contest Edu), tuy nhiên các kĩ thuật sử dụng trong contest Edu của VNOI lại chưa được trình bày cụ thể ở bài viết nào mà chỉ có thể thu được qua việc làm các bài tương tự. Vậy trong bài viết này chúng ta sẽ cùng tìm hiểu một số "dạng" chia căn thường gặp.</p>
<h2 id="chia-block">Chia block<a class="headerlink" href="#chia-block" title="Permanent link">&para;</a></h2>
<h3 id="inh-nghia">Định nghĩa<a class="headerlink" href="#inh-nghia" title="Permanent link">&para;</a></h3>
<p>Thông thường các bài toán chúng ta thường gặp sẽ là chia cấu trúc của ta thành <span class="arithmatex">\(\sqrt{N}\)</span> khối, mỗi khối chứa <span class="arithmatex">\(\sqrt{N}\)</span> phần tử. Với mỗi khối, ta lưu một vài thông tin có ích để có thể truy xuất dữ liệu trong độ phức tạp nhỏ. Với mỗi truy vấn, ta tìm các "khối" giao với đoạn cần quan tâm, và sau đó truy vấn từ các thông tin đã lưu trước đó để có thể truy xuất dữ liệu một cách nhanh chóng. </p>
<h3 id="vi-du">Ví dụ<a class="headerlink" href="#vi-du" title="Permanent link">&para;</a></h3>
<p><a href="https://oj.vnoi.info/problem/olp_sc23_pquery">PQUERY - Siêu cúp 2023</a></p>
<details class="question">
<summary>Đề bài</summary>
<p>Cho dãy <span class="arithmatex">\(A\)</span> gồm các phần tử có giá trị <span class="arithmatex">\(\leq 10^9\)</span> và dãy <span class="arithmatex">\(P\)</span> là hoán vị của các số từ <span class="arithmatex">\(1\)</span> đến <span class="arithmatex">\(N\)</span>. Xử lí 4 loại truy vấn:</p>
<ul>
<li>Gán <span class="arithmatex">\(A_{P_i}=A_{P_i}+v\)</span> với <span class="arithmatex">\(i \in [L, R]\)</span></li>
<li>Tính tổng <span class="arithmatex">\(A[L:R]\)</span></li>
<li>Đổi chỗ <span class="arithmatex">\(P_i, P_j\)</span></li>
<li>Rollback về trước thời điểm thứ <span class="arithmatex">\(T\)</span></li>
</ul>
</details>
<details class="success">
<summary>Lời giải</summary>
<p>Để cho tiện, tất cả các chỉ số sử dụng trong bài ta sẽ chuyển về dạng <span class="arithmatex">\(0-indexed\)</span> thay vì <span class="arithmatex">\(1\)</span> như đề bài cho.
Đầu tiên chúng ta sẽ tìm hiểu cách xử lí bài toán khi không có truy vấn rollback. Để xử lí truy vấn rollback, ta có thể dựng cây theo truy vấn và DFS, tham khảo tại <a href="https://lto5.github.io/old-blog/2022-08-18-query-tree/">đây</a>.
Ta sẽ đồng thời chia mảng <span class="arithmatex">\(A\)</span> và <span class="arithmatex">\(P\)</span> thành <span class="arithmatex">\(\sqrt{N}\)</span> khối, và khối thứ <span class="arithmatex">\(i\)</span> sẽ quản lí đoạn <span class="arithmatex">\([i \times \sqrt{N}, (i + 1) \times \sqrt{N})\)</span>. Vậy mỗi truy vấn ta sẽ thực hiện như thế nào:</p>
<ul>
<li>Truy vấn tăng: Với mỗi khối của <span class="arithmatex">\(P\)</span>, ta lưu thêm một thông tin là <span class="arithmatex">\(lazyP_i\)</span> nghĩa là các chỉ số <span class="arithmatex">\(P_j\)</span> thuộc khối thứ <span class="arithmatex">\(i\)</span> của mảng <span class="arithmatex">\(P\)</span> đã bị tác động lên bao nhiêu lần.<ul>
<li>Nếu <span class="arithmatex">\(L,R\)</span> thuộc cùng một block, ta thực hiện duyệt từ <span class="arithmatex">\(L \Rightarrow R\)</span> và tăng trâu như đề bài bảo.</li>
<li>Ngược lại, gọi <span class="arithmatex">\(b_L\)</span> và <span class="arithmatex">\(b_R\)</span> lần lượt là block chứa <span class="arithmatex">\(L\)</span> và chứa <span class="arithmatex">\(R\)</span>. Với các block <span class="arithmatex">\(i\)</span> có chỉ số thuộc đoạn <span class="arithmatex">\([b_L+1,b_R)\)</span>, ta tiến hành gán <span class="arithmatex">\(lazyP_i=lazyP_i+v\)</span>. Ngược lại, với các phần tử <span class="arithmatex">\(P_i\)</span> mà <span class="arithmatex">\(i \in [L,R] \cap ([b_L \times N, (b_L+1) \times N) \cup [b_R \times N, b_{R+1} \times N))\)</span>, ta tiến hành tăng trâu như khi xử lí trường hợp trên.</li>
<li>Độ phức tạp cho phần này sẽ là <span class="arithmatex">\(\sqrt{N}\)</span>:<ul>
<li>Nếu <span class="arithmatex">\(L\)</span> và <span class="arithmatex">\(R\)</span> thuộc cùng một khối, thì <span class="arithmatex">\(R-L+1 \leq \sqrt{N}\)</span></li>
<li>Nếu <span class="arithmatex">\(L\)</span> và <span class="arithmatex">\(R\)</span> thuộc hai khối khác nhau:<ul>
<li>Ta cần duyệt qua các khối, vậy nếu <span class="arithmatex">\(L=1,R=N\)</span> thì ta có tối đa <span class="arithmatex">\(\frac{N}{\sqrt{N}}=\sqrt{N}\)</span> khối</li>
<li>Độ dài của mỗi khối <span class="arithmatex">\(b_L,b_R\)</span> là <span class="arithmatex">\(\sqrt{N}\)</span>. Vậy đoạn <span class="arithmatex">\([L,R]\)</span> có độ dài như thế nào, thì phần giao của nó với <span class="arithmatex">\(b_L,b_R\)</span> cũng chỉ có độ dài tối đa là <span class="arithmatex">\(\sqrt{N}\)</span>. Như vậy, phần tăng trâu này cũng chỉ duyệt tối đa là <span class="arithmatex">\(2 \times \sqrt{N}\)</span> phần tử.</li>
</ul>
</li>
<li>Như vậy tổng số bước duyệt cho mỗi truy vấn tối đa là <span class="arithmatex">\(3 \times \sqrt{N}\)</span></li>
</ul>
</li>
</ul>
</li>
<li>Truy vấn tính tổng: Ta lưu một mảng <span class="arithmatex">\(sumBlock_x\)</span> thể hiện tổng các phần tử thuộc khối thứ <span class="arithmatex">\(x\)</span>, nghĩa là tổng các phần tử <span class="arithmatex">\(A_i\)</span> với <span class="arithmatex">\(i \in [x \times \sqrt{N}, (x+1) \times \sqrt{N})\)</span><ul>
<li>Nếu <span class="arithmatex">\(L\)</span> và <span class="arithmatex">\(R\)</span> thuộc chung một khối: duyệt <span class="arithmatex">\(i\)</span> từ <span class="arithmatex">\(L\)</span> đến <span class="arithmatex">\(R\)</span>, và cộng đáp án với <span class="arithmatex">\(A_i\)</span>. Tuy nhiên sẽ có trường hợp <span class="arithmatex">\(A_i\)</span> bị cập nhật ở một truy vấn tăng trước đó, nhưng truy vấn tăng này lại chưa cập nhật trực tiếp vào <span class="arithmatex">\(A_i\)</span>. Vậy ta cần cộng đáp án với <span class="arithmatex">\(lazyP_j\)</span> với <span class="arithmatex">\(j\)</span> là chỉ số của block trên mảng <span class="arithmatex">\(P\)</span> và chứa chỉ số <span class="arithmatex">\(i\)</span>, nghĩa là trong block thứ <span class="arithmatex">\(j\)</span> của mảng <span class="arithmatex">\(P\)</span> có tồn tại một giá trị <span class="arithmatex">\(i\)</span></li>
<li>Nếu <span class="arithmatex">\(L\)</span> và <span class="arithmatex">\(R\)</span> thuộc hai khối khác nhau:<ul>
<li>Gọi <span class="arithmatex">\(b_L\)</span> và <span class="arithmatex">\(b_R\)</span> lần lượt là block chứa <span class="arithmatex">\(L\)</span> và chứa <span class="arithmatex">\(R\)</span>. </li>
<li>Với các block <span class="arithmatex">\(i\)</span> có chỉ số thuộc đoạn <span class="arithmatex">\([b_L+1,b_R)\)</span>, ta tiến hành tăng đáp án với <span class="arithmatex">\(sumBlock_i\)</span></li>
<li>Với các chỉ số <span class="arithmatex">\(i \in [L,R] \cap ([b_L \times N, (b_L+1) \times N) \cup [b_R \times N, b_{R+1} \times N))\)</span>, ta tiến hành tăng trâu như khi xử lí trường hợp trên.</li>
<li>Tuy nhiên đáp án vẫn có thể sẽ bị sai với các phần tử thuộc các khối có chỉ số thuộc đoạn <span class="arithmatex">\([b_L+1,b_R)\)</span>, do các phần tử thuộc các khối này cũng có thể đã bị tác động bởi truy vấn tăng trước đó, tuy nhiên lại chưa được ghi nhận vào <span class="arithmatex">\(sumBlock_i\)</span></li>
<li>Một cách giải quyết đó là ta duyệt hết các khối <span class="arithmatex">\(i\)</span> thuộc mảng <span class="arithmatex">\(P\)</span>, và cộng đáp án với <span class="arithmatex">\(lazyP_i \times\)</span> số phần tử <span class="arithmatex">\(P_j\)</span> với <span class="arithmatex">\(j\)</span> thuộc khối <span class="arithmatex">\(i\)</span> và <span class="arithmatex">\(P_j\)</span> thuộc khối <span class="arithmatex">\([b_L+1,b_R)\)</span>. Tuy nhiên ta không thể duyệt hết các phần tử <span class="arithmatex">\(A\)</span> thuộc khối trên được vì có thể sẽ lên đến <span class="arithmatex">\(N\)</span> phần tử. <ul>
<li>Nhận thấy các phần tử thuộc khối <span class="arithmatex">\([b_L+1,b_R)\)</span> sẽ tạo thành một đoạn liên tiếp, như vậy ta có thể xác định được mút trái, mút phải của chúng. Với mỗi khối trên <span class="arithmatex">\(P\)</span> ta có thể lưu một fenwick tree độ dài <span class="arithmatex">\(N\)</span>, với <span class="arithmatex">\(P_{ij}=0/1\)</span> thể hiện xem trong khối <span class="arithmatex">\(P_i\)</span> có phần tử nào bằng <span class="arithmatex">\(j\)</span> không. Như vậy với mỗi khối thuộc khối <span class="arithmatex">\(P\)</span> ta sẽ xử lí trong <span class="arithmatex">\(\log(N)\)</span>, và có <span class="arithmatex">\(\sqrt{N}\)</span> block nên sẽ mất <span class="arithmatex">\(\sqrt{N} \times \log(N)\)</span> cho mỗi truy vấn, sẽ ăn được các subtask <span class="arithmatex">\(N, Q \leq 70000\)</span></li>
<li>Để giảm độ phức tạp ta có thể tính trước một mảng <span class="arithmatex">\(intersect_{ij}\)</span> là phần giao của khối thứ <span class="arithmatex">\(i\)</span> trên mảng <span class="arithmatex">\(P\)</span> và khối thứ <span class="arithmatex">\(j\)</span> trên mảng <span class="arithmatex">\(A\)</span>. Với mỗi cặp <span class="arithmatex">\((i,j)\)</span>, ta duyệt các phần tử <span class="arithmatex">\(P_x\)</span> mà <span class="arithmatex">\(x \in [i \times \sqrt{N}, (i+1) \times \sqrt{N})\)</span> và cộng <span class="arithmatex">\(1\)</span> khi <span class="arithmatex">\(j \times \sqrt{N} \leq P_x &lt; (j + 1) \times \sqrt{N}\)</span>. Cùng với sự hỗ trợ của Prefix Sum, ta giảm được truy vấn xuống <span class="arithmatex">\(\sqrt{N}\)</span></li>
</ul>
</li>
</ul>
</li>
<li>Tương tự trường hợp trên, ta cũng dễ dàng chứng minh được độ phức tạp cho phần này chỉ là <span class="arithmatex">\(O(\sqrt{N})\)</span></li>
<li>Lưu ý mảng <span class="arithmatex">\(sumBlock\)</span> cũng phải được cập nhật khi thực hiện truy vấn update ở trên, việc update như thế nào xin được dành cho bạn đọc.</li>
</ul>
</li>
<li>Truy vấn đổi chỗ:<ul>
<li>Nếu <span class="arithmatex">\(L\)</span> và <span class="arithmatex">\(R\)</span> thuộc cùng một khối thì việc cần làm chỉ là <span class="arithmatex">\(swap(P_L,P_R)\)</span> do các thông tin ta lưu chỉ liên quan đến giá trị các phần tử xuất hiện trong khối, chứ không quan tâm đến thứ tự của chúng.</li>
<li>Ngược lại, gọi <span class="arithmatex">\(b_L\)</span> và <span class="arithmatex">\(b_R\)</span> lần lượt là khối chứa <span class="arithmatex">\(L\)</span> và <span class="arithmatex">\(R\)</span>. <ul>
<li>Đầu tiên ta cần push các thay đổi trong <span class="arithmatex">\(lazyP\)</span> xuống các phần tử <span class="arithmatex">\(a[.]\)</span>. Với mỗi khối <span class="arithmatex">\(i \in \{b_L,b_R\}\)</span>, ta duyệt các <span class="arithmatex">\(j\)</span> nằm trong khối này và tiến hành thay đổi <span class="arithmatex">\(A_{P_j}\)</span> và <span class="arithmatex">\(sumBlock_{\frac{P_j}{\sqrt{N}}}\)</span>. Sau đó gán <span class="arithmatex">\(lazyP_i=0\)</span></li>
<li>Sau đó ta cần thay đổi mảng <span class="arithmatex">\(intersect\)</span>, và swap <span class="arithmatex">\(P_L,P_R\)</span>. Phần update này xin dành cho bài đọc, gợi ý là bằng việc duyệt tất cả các phần tử cần quan tâm để cập nhật, độ phức tạp sẽ là <span class="arithmatex">\(O(\sqrt{N})\)</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Vậy tổng độ phức tạp là: <span class="arithmatex">\(O((N+Q) \times \sqrt{N})\)</span></p>
</details>
<details class="abstract">
<summary>Cài đặt</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">  1</a></span>
<span class="normal"><a href="#__codelineno-0-2">  2</a></span>
<span class="normal"><a href="#__codelineno-0-3">  3</a></span>
<span class="normal"><a href="#__codelineno-0-4">  4</a></span>
<span class="normal"><a href="#__codelineno-0-5">  5</a></span>
<span class="normal"><a href="#__codelineno-0-6">  6</a></span>
<span class="normal"><a href="#__codelineno-0-7">  7</a></span>
<span class="normal"><a href="#__codelineno-0-8">  8</a></span>
<span class="normal"><a href="#__codelineno-0-9">  9</a></span>
<span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="cp">#ifndef LOCAL</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="cp">#define cerr \</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="cp">  if (0) cerr</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="cp">#endif</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="c1">// #define int int64_t</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="kt">void</span><span class="w"> </span><span class="nf">debug_out</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Head</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Tail</span><span class="o">&gt;</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="kt">void</span><span class="w"> </span><span class="n">debug_out</span><span class="p">(</span><span class="n">Head</span><span class="w"> </span><span class="n">H</span><span class="p">,</span><span class="w"> </span><span class="n">Tail</span><span class="p">...</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">  </span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">H</span><span class="p">;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">  </span><span class="n">debug_out</span><span class="p">(</span><span class="n">T</span><span class="p">...);</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="p">}</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="cp">#define debug(...) cerr &lt;&lt; &quot;[&quot; &lt;&lt; #__VA_ARGS__ &lt;&lt; &quot;]:&quot;, debug_out(__VA_ARGS__)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">150005</span><span class="p">;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">490</span><span class="p">;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="kt">int64_t</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="kt">int</span><span class="w"> </span><span class="n">intersect</span><span class="p">[</span><span class="n">S</span><span class="p">][</span><span class="n">S</span><span class="p">];</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="kt">int64_t</span><span class="w"> </span><span class="n">lazyP</span><span class="p">[</span><span class="n">S</span><span class="p">];</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="o">&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="kt">int64_t</span><span class="w"> </span><span class="n">ans</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="kt">int64_t</span><span class="w"> </span><span class="n">sumBlock</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="kt">int</span><span class="w"> </span><span class="n">belong</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="c1">// push all lazyP[.]</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="kt">void</span><span class="w"> </span><span class="nf">push_p</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">block</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">  </span><span class="c1">// O(n) ?</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">  </span><span class="c1">// sumBlock[.]</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">  </span><span class="c1">// a[.]</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">  </span><span class="c1">// intersect[block, .]</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">block</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="w">    </span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lazyP</span><span class="p">[</span><span class="n">block</span><span class="p">];</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="n">sumBlock</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lazyP</span><span class="p">[</span><span class="n">block</span><span class="p">];</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">  </span><span class="n">lazyP</span><span class="p">[</span><span class="n">block</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="p">}</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">    </span><span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">ii</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">      </span><span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">    </span><span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="p">}</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">bL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="n">bR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bL</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">bR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="w">      </span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="w">      </span><span class="n">sumBlock</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">bR</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">    </span><span class="n">lazyP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">bL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="w">    </span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="w">    </span><span class="n">sumBlock</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bR</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">    </span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="w">    </span><span class="n">sumBlock</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="p">}</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="kt">int64_t</span><span class="w"> </span><span class="nf">cal</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">bL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="n">bR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="w">  </span><span class="c1">// debug(l, r);</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="w">  </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bL</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">bR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="w">      </span><span class="c1">// debug(a[i], belong[i], lazyP[belong[i]]);</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">      </span><span class="n">ans</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lazyP</span><span class="p">[</span><span class="n">belong</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">bL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="w">      </span><span class="n">ans</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lazyP</span><span class="p">[</span><span class="n">belong</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">bR</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">      </span><span class="n">ans</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">sumBlock</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">bR</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="w">        </span><span class="n">ans</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lazyP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">bR</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">bL</span><span class="p">]);</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bR</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">      </span><span class="n">ans</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lazyP</span><span class="p">[</span><span class="n">belong</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ans</span><span class="p">;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="p">}</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="kt">void</span><span class="w"> </span><span class="nf">revert</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">blk</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="w">    </span><span class="n">intersect</span><span class="p">[</span><span class="n">blk</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">intersect</span><span class="p">[</span><span class="n">blk</span><span class="p">][</span><span class="n">j</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="p">}</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="kt">void</span><span class="w"> </span><span class="nf">accum</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">blk</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="w">    </span><span class="n">intersect</span><span class="p">[</span><span class="n">blk</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">intersect</span><span class="p">[</span><span class="n">blk</span><span class="p">][</span><span class="n">j</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="p">}</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">delta</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">block_pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">lo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">block_pos</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="n">hi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">block_pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="w">  </span><span class="n">intersect</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="n">block_pos</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">lo</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">hi</span><span class="p">);</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="p">}</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="c1">// p_l, p_r</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="kt">void</span><span class="w"> </span><span class="nf">swap_p</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">bL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="n">bR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bL</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">bR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="w">    </span><span class="n">swap</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">r</span><span class="p">]);</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="w">  </span><span class="n">push_p</span><span class="p">(</span><span class="n">bL</span><span class="p">);</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">  </span><span class="n">push_p</span><span class="p">(</span><span class="n">bR</span><span class="p">);</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="w">  </span><span class="n">revert</span><span class="p">(</span><span class="n">bL</span><span class="p">);</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="w">  </span><span class="n">revert</span><span class="p">(</span><span class="n">bR</span><span class="p">);</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">bL</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">bR</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="w">  </span><span class="n">swap</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">r</span><span class="p">]);</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="w">  </span><span class="n">belong</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">l</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="w">  </span><span class="n">belong</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">bL</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">bR</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">  </span><span class="c1">// intersect[bL][block contains p[l]] -=</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="w">  </span><span class="n">accum</span><span class="p">(</span><span class="n">bL</span><span class="p">);</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="w">  </span><span class="n">accum</span><span class="p">(</span><span class="n">bR</span><span class="p">);</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="p">}</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="kt">void</span><span class="w"> </span><span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">ans</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cal</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="w">      </span><span class="n">update</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="w">      </span><span class="n">swap_p</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="w">    </span><span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">      </span><span class="n">update</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="p">);</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="w">      </span><span class="n">swap_p</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="p">}</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="kt">int32_t</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="w">  </span><span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="w">  </span><span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="w">  </span><span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="cp">#ifdef LOCAL</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="cp">#define task &quot;a&quot;</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="cp">#else</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="cp">#define task &quot;PQUERY&quot;</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="cp">#endif</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fopen</span><span class="p">(</span><span class="n">task</span><span class="w"> </span><span class="s">&quot;.inp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="w">    </span><span class="n">freopen</span><span class="p">(</span><span class="n">task</span><span class="w"> </span><span class="s">&quot;.inp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stdin</span><span class="p">);</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="w">    </span><span class="n">freopen</span><span class="p">(</span><span class="n">task</span><span class="w"> </span><span class="s">&quot;.out&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stdout</span><span class="p">);</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="w">  </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="w">    </span><span class="n">sumBlock</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="w">    </span><span class="o">--</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">    </span><span class="n">belong</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="w">    </span><span class="n">build</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="w">      </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="w">      </span><span class="o">--</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">      </span><span class="o">--</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="w">      </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="w">      </span><span class="o">--</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="w">      </span><span class="o">--</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="w">      </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="w">      </span><span class="n">g</span><span class="p">[</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="w">      </span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="w">  </span><span class="n">dfs</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<h3 id="bai-tap-ap-dung">Bài tập áp dụng<a class="headerlink" href="#bai-tap-ap-dung" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://codeforces.com/problemset/problem/13/E">Codeforces 13E</a></li>
<li><a href="https://oj.vnoi.info/problem/fc_fyt_day1_xorocc">XOROCC</a></li>
<li><a href="https://www.codechef.com/NOV14/problems/FNCS/">FNCS - Codechef</a></li>
<li><a href="https://tleoj.edu.vn/problem/26h">TLEOJ Cup Final Day 2 - Tráo bài</a></li>
</ul>
<h2 id="chia-theo-truy-van">Chia theo truy vấn<a class="headerlink" href="#chia-theo-truy-van" title="Permanent link">&para;</a></h2>
<h3 id="gioi-thieu">Giới thiệu<a class="headerlink" href="#gioi-thieu" title="Permanent link">&para;</a></h3>
<p>Tư tưởng chính của thuật toán sẽ là: Khi đọc được một truy vấn thay đổi, thay vì tác động trực tiếp lên các cấu trúc dữ liệu để cập nhật, ta sẽ "ghi nhớ" lại truy vấn này vào một mảng <code>buffer</code>. Khi gặp một truy vấn hỏi, kết hợp với dữ liệu có sẵn, cùng mảng <code>buffer</code>, sẽ cho ra được đáp án. Khi <code>buffer</code> đầy, ta thực hiện cập nhật các thao tác trong <code>buffer</code> lên cấu trúc sẵn có.</p>
<h3 id="vi-du_1">Ví dụ<a class="headerlink" href="#vi-du_1" title="Permanent link">&para;</a></h3>
<p><a href="https://cses.fi/problemset/task/2074">Reversal and Sum - CSES</a></p>
<details class="question">
<summary>Đề bài</summary>
<p>Cho mảng <span class="arithmatex">\(a\)</span> có <span class="arithmatex">\(n\)</span> phần tử. Xử lý <span class="arithmatex">\(q\)</span> truy vấn thuộc hai loại:</p>
<ul>
<li>Đảo ngược đoạn <span class="arithmatex">\([l,r]\)</span></li>
<li>Tính tổng đoạn <span class="arithmatex">\([l,r]\)</span></li>
</ul>
</details>
<details class="success">
<summary>Lời giải</summary>
<p>Trước tiên, ta cũng chia mảng <span class="arithmatex">\(a\)</span> ra thành <span class="arithmatex">\(\frac{n}{T}\)</span> đoạn, mỗi đoạn có <span class="arithmatex">\(T\)</span> phần tử. Mỗi khối sẽ chứa các phần tử có chỉ số <span class="arithmatex">\(i \times T\)</span> đến <span class="arithmatex">\((i+1)\times T-1\)</span></p>
<p>Với mỗi truy vấn tìm tổng <span class="arithmatex">\([l,r]\)</span>; ta sẽ tìm block chứa <span class="arithmatex">\(l\)</span>, và cắt nó ra làm hai phần: từ đầu block chứa <span class="arithmatex">\(l\)</span> đến <span class="arithmatex">\(l-1\)</span>, và từ <span class="arithmatex">\(l\)</span> đến cuối block chứa <span class="arithmatex">\(l\)</span>. Sau đó, ta tiếp tìm block chứa <span class="arithmatex">\(r+1\)</span>, và cắt nó ra làm hai phần tương tự như trên.</p>
<p><img alt="image" src="https://i.imgur.com/7zqlRWh.png" /></p>
<p>Lúc này, trong mảng chỉ gồm các khối nằm gọn trong đoạn <span class="arithmatex">\([l,r]\)</span>, ta tiến hành duyệt qua các khối này và ghi nhận tổng vào đáp án.</p>
<p><img alt="image" src="https://i.imgur.com/hLeba3z.png" /></p>
<p>Còn với truy vấn đảo ngược đoạn <span class="arithmatex">\([l,r]\)</span>, ta cũng tiến hành cắt ghép như vậy. Với mỗi khối, ta lưu thêm một trường <code>is_reversed</code>, nghĩa là trước đây khối này đã được thực hiện truy vấn đảo ngược chưa. Lưu ý, đảo ngược 2 lần có nghĩa là không đảo ngược. Vậy nên, <code>is_reversed</code> chỉ có hai trạng thái: <span class="arithmatex">\(0/1\)</span>. Nhận thấy các khối nằm gọn trong đoạn <span class="arithmatex">\([l,r]\)</span> thuộc một đoạn liên tiếp. Nên ta chỉ cần đảo ngược đoạn này cũng như gán <code>is_reversed=!is_reversed</code> với các khối này.</p>
<p>Với mỗi truy vấn, ta tạo thêm 2 block mới. Vậy trường hợp xấu nhất ta sẽ tạo thêm <span class="arithmatex">\(q\)</span> block và phải duyệt qua toàn bộ các block này. Để tránh dính phải trường hợp này, sau mỗi <span class="arithmatex">\(T\)</span> truy vấn, ta tiến hành <code>rebuild</code> lại cấu trúc, nghĩa là trả lại mảng <span class="arithmatex">\(a\)</span> về giá trị của nó sau <span class="arithmatex">\(T\)</span> truy vấn, và chia lại nó thành <span class="arithmatex">\(\frac{n}{T}\)</span> block.</p>
<p>Lưu ý còn một phần nữa là việc xử lí các chỉ số trong khi thực hiện đảo ngược khối, phần này xin dành cho bạn đọc.</p>
<p>Suy ra với mỗi truy vấn, ta duyệt qua không quá <span class="arithmatex">\(3T\)</span> khối. Và cứ <span class="arithmatex">\(T\)</span> lần ta lại xây dựng lại cấu trúc, vậy ta có <span class="arithmatex">\(\frac{q}{T}\)</span> lần rebuild và mỗi lần rebuild mất <span class="arithmatex">\(O(n)\)</span>. Vậy độ phức tạp cuối cùng là <span class="arithmatex">\(q \times 3T + n \times \frac{q}{T}\)</span>. Ta có thể chọn <span class="arithmatex">\(T=\sqrt{n}\)</span> để đạt một độ phức tạp khá tốt và đủ để AC bài này.</p>
<blockquote>
<p>Bài toán vẫn có thể giải được bằng phương pháp chia block giống như ở trên, tuy nhiên việc cài đặt sẽ phức tạp hơn. Vẫn có nhiều bài toán chỉ có thể giải được bằng phương pháp này.</p>
</blockquote>
</details>
<details class="abstract">
<summary>Cài đặt</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">  1</a></span>
<span class="normal"><a href="#__codelineno-1-2">  2</a></span>
<span class="normal"><a href="#__codelineno-1-3">  3</a></span>
<span class="normal"><a href="#__codelineno-1-4">  4</a></span>
<span class="normal"><a href="#__codelineno-1-5">  5</a></span>
<span class="normal"><a href="#__codelineno-1-6">  6</a></span>
<span class="normal"><a href="#__codelineno-1-7">  7</a></span>
<span class="normal"><a href="#__codelineno-1-8">  8</a></span>
<span class="normal"><a href="#__codelineno-1-9">  9</a></span>
<span class="normal"><a href="#__codelineno-1-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-1-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-1-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-1-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-1-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-1-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-1-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-1-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-1-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-1-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-1-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-1-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-1-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-1-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-1-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-1-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-1-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-1-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-1-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-1-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-1-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-1-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-1-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-1-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-1-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-1-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-1-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-1-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-1-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-1-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-1-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-1-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-1-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-1-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-1-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-1-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-1-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-1-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-1-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-1-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-1-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-1-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-1-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-1-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-1-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-1-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-1-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-1-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-1-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-1-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-1-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-1-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-1-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-1-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-1-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-1-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-1-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-1-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-1-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-1-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-1-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-1-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-1-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-1-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-1-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-1-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-1-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-1-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-1-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-1-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-1-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-1-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-1-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-1-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-1-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-1-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-1-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-1-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-1-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-1-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-1-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-1-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-1-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-1-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-1-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-1-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-1-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-1-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-1-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-1-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-1-100">100</a></span>
<span class="normal"><a href="#__codelineno-1-101">101</a></span>
<span class="normal"><a href="#__codelineno-1-102">102</a></span>
<span class="normal"><a href="#__codelineno-1-103">103</a></span>
<span class="normal"><a href="#__codelineno-1-104">104</a></span>
<span class="normal"><a href="#__codelineno-1-105">105</a></span>
<span class="normal"><a href="#__codelineno-1-106">106</a></span>
<span class="normal"><a href="#__codelineno-1-107">107</a></span>
<span class="normal"><a href="#__codelineno-1-108">108</a></span>
<span class="normal"><a href="#__codelineno-1-109">109</a></span>
<span class="normal"><a href="#__codelineno-1-110">110</a></span>
<span class="normal"><a href="#__codelineno-1-111">111</a></span>
<span class="normal"><a href="#__codelineno-1-112">112</a></span>
<span class="normal"><a href="#__codelineno-1-113">113</a></span>
<span class="normal"><a href="#__codelineno-1-114">114</a></span>
<span class="normal"><a href="#__codelineno-1-115">115</a></span>
<span class="normal"><a href="#__codelineno-1-116">116</a></span>
<span class="normal"><a href="#__codelineno-1-117">117</a></span>
<span class="normal"><a href="#__codelineno-1-118">118</a></span>
<span class="normal"><a href="#__codelineno-1-119">119</a></span>
<span class="normal"><a href="#__codelineno-1-120">120</a></span>
<span class="normal"><a href="#__codelineno-1-121">121</a></span>
<span class="normal"><a href="#__codelineno-1-122">122</a></span>
<span class="normal"><a href="#__codelineno-1-123">123</a></span>
<span class="normal"><a href="#__codelineno-1-124">124</a></span>
<span class="normal"><a href="#__codelineno-1-125">125</a></span>
<span class="normal"><a href="#__codelineno-1-126">126</a></span>
<span class="normal"><a href="#__codelineno-1-127">127</a></span>
<span class="normal"><a href="#__codelineno-1-128">128</a></span>
<span class="normal"><a href="#__codelineno-1-129">129</a></span>
<span class="normal"><a href="#__codelineno-1-130">130</a></span>
<span class="normal"><a href="#__codelineno-1-131">131</a></span>
<span class="normal"><a href="#__codelineno-1-132">132</a></span>
<span class="normal"><a href="#__codelineno-1-133">133</a></span>
<span class="normal"><a href="#__codelineno-1-134">134</a></span>
<span class="normal"><a href="#__codelineno-1-135">135</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2e5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">450</span><span class="p">;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Range</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">  </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_reversed</span><span class="p">;</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">  </span><span class="n">Range</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">is_reversed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">l</span><span class="p">(</span><span class="n">l</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">(</span><span class="n">r</span><span class="p">),</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">sum</span><span class="p">),</span><span class="w"> </span><span class="n">is_reversed</span><span class="p">(</span><span class="n">is_reversed</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="p">};</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="kt">int</span><span class="w"> </span><span class="n">new_a</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="kt">int64_t</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="n">Range</span><span class="w"> </span><span class="n">segments</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="kt">int</span><span class="w"> </span><span class="n">cnt_ranges</span><span class="p">;</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="c1">// xây dựng lại các block trong a</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="kt">void</span><span class="w"> </span><span class="nf">rebuild</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt_ranges</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="n">is_rev</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">segments</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_rev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">l</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">        </span><span class="n">new_a</span><span class="p">[</span><span class="o">++</span><span class="n">cur</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="w">        </span><span class="n">new_a</span><span class="p">[</span><span class="o">++</span><span class="n">cur</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a><span class="w">    </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="w">    </span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="w">  </span><span class="n">cnt_ranges</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a><span class="w">    </span><span class="n">segments</span><span class="p">[</span><span class="o">++</span><span class="n">cnt_ranges</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">min</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a><span class="p">}</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="kt">void</span><span class="w"> </span><span class="nf">insert_seg</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">Range</span><span class="w"> </span><span class="n">rng</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cnt_ranges</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">pos</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a><span class="w">    </span><span class="n">segments</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">segments</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a><span class="w">  </span><span class="n">segments</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rng</span><span class="p">;</span>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="w">  </span><span class="n">cnt_ranges</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-1-54" name="__codelineno-1-54"></a><span class="p">}</span>
<a id="__codelineno-1-55" name="__codelineno-1-55"></a>
<a id="__codelineno-1-56" name="__codelineno-1-56"></a><span class="c1">// tách block chứa `pos` thành 2 phần: từ đầu block chứa `pos` -&gt; `pos` - 1, và từ `pos` -&gt; cuối block chứa `pos`</span>
<a id="__codelineno-1-57" name="__codelineno-1-57"></a><span class="c1">// và trả về chỉ số của block chứa `pos`</span>
<a id="__codelineno-1-58" name="__codelineno-1-58"></a><span class="kt">int</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-59" name="__codelineno-1-59"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">cur_low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="n">cur_high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-60" name="__codelineno-1-60"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt_ranges</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-61" name="__codelineno-1-61"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="n">is_rev</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">segments</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-62" name="__codelineno-1-62"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-63" name="__codelineno-1-63"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">next_low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur_high</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-64" name="__codelineno-1-64"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">next_high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_low</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-65" name="__codelineno-1-65"></a><span class="w">    </span><span class="n">cur_low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_low</span><span class="p">;</span>
<a id="__codelineno-1-66" name="__codelineno-1-66"></a><span class="w">    </span><span class="n">cur_high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_high</span><span class="p">;</span>
<a id="__codelineno-1-67" name="__codelineno-1-67"></a><span class="w">    </span><span class="c1">// đang ở block bên trái `pos`</span>
<a id="__codelineno-1-68" name="__codelineno-1-68"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">next_high</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-1-69" name="__codelineno-1-69"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">next_low</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-70" name="__codelineno-1-70"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-1-71" name="__codelineno-1-71"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-72" name="__codelineno-1-72"></a><span class="w">    </span><span class="n">Range</span><span class="w"> </span><span class="n">range_left</span><span class="p">,</span><span class="w"> </span><span class="n">range_right</span><span class="p">;</span>
<a id="__codelineno-1-73" name="__codelineno-1-73"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">left_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">next_low</span><span class="p">,</span><span class="w"> </span><span class="n">right_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_high</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-74" name="__codelineno-1-74"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">is_rev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-75" name="__codelineno-1-75"></a><span class="w">      </span><span class="n">range_left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Range</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">left_len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">left_len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-1-76" name="__codelineno-1-76"></a><span class="w">      </span><span class="n">range_right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Range</span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">left_len</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">left_len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-1-77" name="__codelineno-1-77"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-78" name="__codelineno-1-78"></a><span class="w">      </span><span class="n">range_left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Range</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">left_len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">left_len</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-1-79" name="__codelineno-1-79"></a><span class="w">      </span><span class="n">range_right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Range</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">left_len</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">left_len</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-1-80" name="__codelineno-1-80"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-81" name="__codelineno-1-81"></a><span class="w">    </span><span class="n">segments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range_left</span><span class="p">;</span>
<a id="__codelineno-1-82" name="__codelineno-1-82"></a><span class="w">    </span><span class="n">insert_seg</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">range_right</span><span class="p">);</span>
<a id="__codelineno-1-83" name="__codelineno-1-83"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-84" name="__codelineno-1-84"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-1-85" name="__codelineno-1-85"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">cnt_ranges</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-86" name="__codelineno-1-86"></a><span class="p">}</span>
<a id="__codelineno-1-87" name="__codelineno-1-87"></a>
<a id="__codelineno-1-88" name="__codelineno-1-88"></a><span class="kt">void</span><span class="w"> </span><span class="nf">do_reverse</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-89" name="__codelineno-1-89"></a><span class="w">  </span><span class="c1">// xuất phát từ điểm l</span>
<a id="__codelineno-1-90" name="__codelineno-1-90"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">block_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
<a id="__codelineno-1-91" name="__codelineno-1-91"></a><span class="w">  </span><span class="c1">// kết thúc từ điểm r -&gt; phải xoá điểm r+1</span>
<a id="__codelineno-1-92" name="__codelineno-1-92"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">block_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-1-93" name="__codelineno-1-93"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">block_l</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">block_r</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-94" name="__codelineno-1-94"></a><span class="w">    </span><span class="n">segments</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">is_reversed</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-95" name="__codelineno-1-95"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-1-96" name="__codelineno-1-96"></a><span class="w">  </span><span class="n">reverse</span><span class="p">(</span><span class="n">segments</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">block_l</span><span class="p">,</span><span class="w"> </span><span class="n">segments</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">block_r</span><span class="p">);</span>
<a id="__codelineno-1-97" name="__codelineno-1-97"></a><span class="p">}</span>
<a id="__codelineno-1-98" name="__codelineno-1-98"></a>
<a id="__codelineno-1-99" name="__codelineno-1-99"></a><span class="kt">int64_t</span><span class="w"> </span><span class="nf">get_sum</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-100" name="__codelineno-1-100"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">block_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
<a id="__codelineno-1-101" name="__codelineno-1-101"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">block_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-1-102" name="__codelineno-1-102"></a><span class="w">  </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-103" name="__codelineno-1-103"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">block_l</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">block_r</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-104" name="__codelineno-1-104"></a><span class="w">    </span><span class="n">ans</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">segments</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sum</span><span class="p">;</span>
<a id="__codelineno-1-105" name="__codelineno-1-105"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-1-106" name="__codelineno-1-106"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ans</span><span class="p">;</span>
<a id="__codelineno-1-107" name="__codelineno-1-107"></a><span class="p">}</span>
<a id="__codelineno-1-108" name="__codelineno-1-108"></a>
<a id="__codelineno-1-109" name="__codelineno-1-109"></a><span class="kt">int32_t</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-110" name="__codelineno-1-110"></a><span class="w">  </span><span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-1-111" name="__codelineno-1-111"></a><span class="w">  </span><span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-1-112" name="__codelineno-1-112"></a><span class="w">  </span><span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-1-113" name="__codelineno-1-113"></a><span class="w">  </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-1-114" name="__codelineno-1-114"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-115" name="__codelineno-1-115"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-116" name="__codelineno-1-116"></a><span class="w">    </span><span class="n">new_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-117" name="__codelineno-1-117"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-1-118" name="__codelineno-1-118"></a><span class="w">  </span><span class="n">rebuild</span><span class="p">();</span>
<a id="__codelineno-1-119" name="__codelineno-1-119"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-120" name="__codelineno-1-120"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-1-121" name="__codelineno-1-121"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-1-122" name="__codelineno-1-122"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-123" name="__codelineno-1-123"></a><span class="w">      </span><span class="n">do_reverse</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<a id="__codelineno-1-124" name="__codelineno-1-124"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-125" name="__codelineno-1-125"></a><span class="w">      </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">get_sum</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-1-126" name="__codelineno-1-126"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-127" name="__codelineno-1-127"></a><span class="w">    </span><span class="c1">// mỗi truy vấn tạo ra tối đa hai đoạn mới</span>
<a id="__codelineno-1-128" name="__codelineno-1-128"></a><span class="w">    </span><span class="c1">// khi số đoạn thêm vào vượt quá sqrt(q), khởi tạo lại để đảm bảo số đoạn cần xét trong mỗi query không vượt quá 2 * sqrt(n)</span>
<a id="__codelineno-1-129" name="__codelineno-1-129"></a><span class="w">    </span><span class="c1">// số lần khởi tạo lại là q / sqrt(q) = sqrt(q), mỗi lần khởi tạo mất O(n) -&gt; n * sqrt(q)</span>
<a id="__codelineno-1-130" name="__codelineno-1-130"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-131" name="__codelineno-1-131"></a><span class="w">      </span><span class="n">rebuild</span><span class="p">();</span>
<a id="__codelineno-1-132" name="__codelineno-1-132"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-133" name="__codelineno-1-133"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-1-134" name="__codelineno-1-134"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-135" name="__codelineno-1-135"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<details class="note">
<summary>Bonus</summary>
<p><em>Nếu có thêm truy vấn chèn/xoá phần tử, bạn có làm được không, và độ phức tạp tốt nhất là bao nhiêu?</em></p>
</details>
<h3 id="bai-tap-ap-dung_1">Bài tập áp dụng<a class="headerlink" href="#bai-tap-ap-dung_1" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://oj.vnoi.info/contest/sqrt">Edu SQRT Contest - Part 1</a></li>
<li><a href="https://oj.vnoi.info/contest/sqrt">Edu SQRT Contest - Part 2</a></li>
<li><a href="https://vjudge.net/problem/TopCoder-13206">TopCoder 13206 - TreeColoring</a></li>
</ul>
<h2 id="chia-2-cach-lam">Chia 2 cách làm<a class="headerlink" href="#chia-2-cach-lam" title="Permanent link">&para;</a></h2>
<h3 id="inh-nghia_1">Định nghĩa<a class="headerlink" href="#inh-nghia_1" title="Permanent link">&para;</a></h3>
<p>Giả sử ta có <span class="arithmatex">\(N\)</span> tập <span class="arithmatex">\(A_1, A_2, \cdots, A_N\)</span> và <span class="arithmatex">\(|A_1| + |A_2| + \cdots + |A_N| = M\)</span>. Khi đó ta có một nhận xét: có không quá <span class="arithmatex">\(\sqrt{M}\)</span> tập <span class="arithmatex">\(A_i\)</span> có <span class="arithmatex">\(|A_i|&gt;\sqrt{M}\)</span>. Chứng minh rất dễ dàng bằng phản chứng: nếu có nhiều hơn <span class="arithmatex">\(\sqrt{M}\)</span> tập lớn như vậy, thì <span class="arithmatex">\(|A_1| + |A_2| + \cdots + |A_N|&gt;\sqrt{M} \times \sqrt{M}=M\)</span>, vô lí.</p>
<p>Như vậy, tư tưởng của các bài toán này sẽ là phân các tập hợp ra làm hai loại: một loại có ít hon <span class="arithmatex">\(\sqrt{M}\)</span> phần tử, và một loại có nhiều hơn <span class="arithmatex">\(\sqrt{M}\)</span> phần tử. Lợi dụng vào nhận xét trên, ta sẽ chọn cách làm thích hợp với từng tập hợp để độ phức tạp cho việc xử lí từng truy vấn không vượt quá <span class="arithmatex">\(\sqrt{M}\)</span></p>
<h3 id="vi-du_2">Ví dụ<a class="headerlink" href="#vi-du_2" title="Permanent link">&para;</a></h3>
<p><a href="https://codeforces.com/contest/398/problem/D">398D Codeforces</a></p>
<details class="question">
<summary>Đề bài</summary>
<p>Cho đồ thị <span class="arithmatex">\(N\)</span> đỉnh, <span class="arithmatex">\(M\)</span> cạnh. Xử lí 5 loại truy vấn:</p>
<ul>
<li>Gán <span class="arithmatex">\(F_u=1\)</span></li>
<li>Gán <span class="arithmatex">\(F_u=0\)</span></li>
<li>Nối cạnh <span class="arithmatex">\((u,v)\)</span></li>
<li>Xoá cạnh <span class="arithmatex">\((u,v)\)</span></li>
<li>Đếm số đỉnh <span class="arithmatex">\(v\)</span> kề với <span class="arithmatex">\(u\)</span> và <span class="arithmatex">\(F_v=1\)</span></li>
</ul>
</details>
<details class="success">
<summary>Lời giải</summary>
<details class="tip">
<summary>Thuật trâu 1</summary>
<p>Sử dụng <code>std::set</code> lưu trữ danh sách kề của đồ thị. Với mỗi truy vấn thêm/xoá cạnh, ta xử lí trong <span class="arithmatex">\(O(log)\)</span> bằng các thao tác chèn xoá trên <code>set</code>. Với mỗi truy vấn gán, ta gán <span class="arithmatex">\(F\)</span> tương ứng bằng <span class="arithmatex">\(1/0\)</span>. Với truy vấn hỏi, ta duyệt toàn bộ danh sách các đỉnh kề với <span class="arithmatex">\(u\)</span> và đếm số đỉnh <span class="arithmatex">\(v\)</span> có <span class="arithmatex">\(F_v=1\)</span>. Thuật toán này có độ phức tạp xấu nhất là <span class="arithmatex">\(O(nq)\)</span> khi ta có thể tạo test để làm các truy vấn hỏi chạy trong <span class="arithmatex">\(O(n)\)</span> bằng việc cho đồ thị <span class="arithmatex">\(n\)</span> đỉnh và <span class="arithmatex">\(q\)</span> truy vấn hỏi đỉnh <span class="arithmatex">\(1\)</span> như sau:</p>
<p><img alt="image" src="https://i.imgur.com/nr5czAy.png" /></p>
</details>
<details class="tip">
<summary>Thuật trâu 2</summary>
<p>Ta lưu mảng <span class="arithmatex">\(ans_u\)</span> là đáp án cho đỉnh <span class="arithmatex">\(u\)</span>. Với mỗi truy vấn cập nhật <span class="arithmatex">\(F_u\)</span>, ta duyệt toàn bộ đỉnh <span class="arithmatex">\(v\)</span> kề <span class="arithmatex">\(u\)</span> và cập nhật mảng <span class="arithmatex">\(ans_v\)</span> tương ứng. Với mỗi truy vấn thêm xoá cạnh, ta dễ dàng cập nhật <span class="arithmatex">\(ans_u\)</span> và <span class="arithmatex">\(ans_v\)</span> trong <span class="arithmatex">\(O(1)\)</span>. Còn với truy vấn hỏi, ta chỉ việc in ra <span class="arithmatex">\(ans_u\)</span>. Tương tự thuật toán trên, ta cũng có thể chỉ ra được worst case của mỗi truy vấn cập nhật là <span class="arithmatex">\(O(n)\)</span></p>
</details>
<details class="tip">
<summary>Thuật toán chuẩn</summary>
<p>Nhận thấy nhược điểm của cả hai thuật toán là đều chạy chậm khi một đỉnh bị kề với quá nhiều đỉnh khác. Ta sẽ thử kết hợp hai thuật toán trên lại với nhau:</p>
<ul>
<li>Trước tiên, đọc vào tất cả các truy vấn. Xác định mảng <span class="arithmatex">\(deg_u\)</span> là bậc tối đa của đỉnh u, mảng này có thể được tính bằng cách add hết các cạnh trong đồ thị cũng như các truy vấn thêm cạnh</li>
<li>Gọi <span class="arithmatex">\(u\)</span> là đỉnh "lớn" nếu <span class="arithmatex">\(deg_u&gt;S\)</span>, và <span class="arithmatex">\(u\)</span> là đỉnh "bé" nếu ngược lại. Lưu mảng <span class="arithmatex">\(ans_u\)</span> là đáp án cho đỉnh <span class="arithmatex">\(u\)</span>, lưu ý mảng <span class="arithmatex">\(ans\)</span> chỉ lưu cho các đỉnh <span class="arithmatex">\(u\)</span> là đỉnh "lớn".</li>
<li>Ta sẽ xử lí các truy vấn như sau:<ul>
<li>Với truy vấn thay đổi <span class="arithmatex">\(F_u\)</span>, ta thay đổi <span class="arithmatex">\(F_u\)</span> như bình thường. Sau đó, ta duyệt các đỉnh <span class="arithmatex">\(v\)</span> là đỉnh "lớn" và kề với <span class="arithmatex">\(u\)</span>, và cập nhật <span class="arithmatex">\(ans_v\)</span></li>
<li>Với truy vấn thay đổi cạnh, ta thay đổi danh sách kề bằng <code>std::set</code> như thuật toán trâu. Nếu <span class="arithmatex">\(u\)</span> hoặc <span class="arithmatex">\(v\)</span> là đỉnh "lớn", thì ta cần cập nhật lại <span class="arithmatex">\(ans_u\)</span> và <span class="arithmatex">\(ans_v\)</span> tương ứng.</li>
<li>Với truy vấn hỏi, nếu <span class="arithmatex">\(u\)</span> là đỉnh lớn, thì ta truy vấn trong <span class="arithmatex">\(ans_u\)</span>. Ngược lại, ta làm như thuật toán trâu thứ nhất để tính đáp án.</li>
</ul>
</li>
</ul>
<p>Đánh giá độ phức tạp:</p>
<ul>
<li>Đặt <span class="arithmatex">\(D=\sum_{i=1}^{N}deg_i\)</span></li>
<li>Khi truy vấn vào đỉnh bé, ta chỉ cần duyệt không quá <span class="arithmatex">\(O(S)\)</span></li>
<li>Khi truy vấn vào đỉnh lớn, ta cần duyệt không quá <span class="arithmatex">\(O(\frac{D}{S})\)</span></li>
<li>Vậy độ phức tạp cho <span class="arithmatex">\(Q\)</span> truy vấn tối đa là <span class="arithmatex">\(O(Q(S+\frac{D}{S}))\)</span>. Ta cần tìm <span class="arithmatex">\(S\)</span> để biểu thức đạt giá trị nhỏ nhất. Áp dụng bất đẳng thức Cosi, ta có <span class="arithmatex">\(S + \frac{D}{S} \geq 2 \times \sqrt{D}\)</span>. Dấu bằng xảy ra tại <span class="arithmatex">\(S=\frac{D}{S} \Leftrightarrow S=\sqrt{D}\)</span>. </li>
<li>Như vậy, có thể kết luận độ phức tạp tối đa là <span class="arithmatex">\(O(Q\sqrt{M+Q})\)</span></li>
</ul>
</details>
</details>
<details class="abstract">
<summary>Cài đặt</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">  1</a></span>
<span class="normal"><a href="#__codelineno-2-2">  2</a></span>
<span class="normal"><a href="#__codelineno-2-3">  3</a></span>
<span class="normal"><a href="#__codelineno-2-4">  4</a></span>
<span class="normal"><a href="#__codelineno-2-5">  5</a></span>
<span class="normal"><a href="#__codelineno-2-6">  6</a></span>
<span class="normal"><a href="#__codelineno-2-7">  7</a></span>
<span class="normal"><a href="#__codelineno-2-8">  8</a></span>
<span class="normal"><a href="#__codelineno-2-9">  9</a></span>
<span class="normal"><a href="#__codelineno-2-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-2-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-2-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-2-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-2-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-2-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-2-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-2-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-2-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-2-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-2-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-2-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-2-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-2-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-2-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-2-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-2-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-2-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-2-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-2-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-2-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-2-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-2-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-2-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-2-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-2-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-2-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-2-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-2-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-2-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-2-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-2-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-2-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-2-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-2-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-2-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-2-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-2-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-2-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-2-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-2-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-2-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-2-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-2-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-2-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-2-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-2-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-2-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-2-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-2-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-2-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-2-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-2-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-2-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-2-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-2-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-2-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-2-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-2-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-2-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-2-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-2-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-2-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-2-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-2-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-2-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-2-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-2-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-2-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-2-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-2-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-2-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-2-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-2-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-2-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-2-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-2-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-2-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-2-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-2-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-2-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-2-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-2-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-2-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-2-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-2-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-2-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-2-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-2-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-2-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-2-100">100</a></span>
<span class="normal"><a href="#__codelineno-2-101">101</a></span>
<span class="normal"><a href="#__codelineno-2-102">102</a></span>
<span class="normal"><a href="#__codelineno-2-103">103</a></span>
<span class="normal"><a href="#__codelineno-2-104">104</a></span>
<span class="normal"><a href="#__codelineno-2-105">105</a></span>
<span class="normal"><a href="#__codelineno-2-106">106</a></span>
<span class="normal"><a href="#__codelineno-2-107">107</a></span>
<span class="normal"><a href="#__codelineno-2-108">108</a></span>
<span class="normal"><a href="#__codelineno-2-109">109</a></span>
<span class="normal"><a href="#__codelineno-2-110">110</a></span>
<span class="normal"><a href="#__codelineno-2-111">111</a></span>
<span class="normal"><a href="#__codelineno-2-112">112</a></span>
<span class="normal"><a href="#__codelineno-2-113">113</a></span>
<span class="normal"><a href="#__codelineno-2-114">114</a></span>
<span class="normal"><a href="#__codelineno-2-115">115</a></span>
<span class="normal"><a href="#__codelineno-2-116">116</a></span>
<span class="normal"><a href="#__codelineno-2-117">117</a></span>
<span class="normal"><a href="#__codelineno-2-118">118</a></span>
<span class="normal"><a href="#__codelineno-2-119">119</a></span>
<span class="normal"><a href="#__codelineno-2-120">120</a></span>
<span class="normal"><a href="#__codelineno-2-121">121</a></span>
<span class="normal"><a href="#__codelineno-2-122">122</a></span>
<span class="normal"><a href="#__codelineno-2-123">123</a></span>
<span class="normal"><a href="#__codelineno-2-124">124</a></span>
<span class="normal"><a href="#__codelineno-2-125">125</a></span>
<span class="normal"><a href="#__codelineno-2-126">126</a></span>
<span class="normal"><a href="#__codelineno-2-127">127</a></span>
<span class="normal"><a href="#__codelineno-2-128">128</a></span>
<span class="normal"><a href="#__codelineno-2-129">129</a></span>
<span class="normal"><a href="#__codelineno-2-130">130</a></span>
<span class="normal"><a href="#__codelineno-2-131">131</a></span>
<span class="normal"><a href="#__codelineno-2-132">132</a></span>
<span class="normal"><a href="#__codelineno-2-133">133</a></span>
<span class="normal"><a href="#__codelineno-2-134">134</a></span>
<span class="normal"><a href="#__codelineno-2-135">135</a></span>
<span class="normal"><a href="#__codelineno-2-136">136</a></span>
<span class="normal"><a href="#__codelineno-2-137">137</a></span>
<span class="normal"><a href="#__codelineno-2-138">138</a></span>
<span class="normal"><a href="#__codelineno-2-139">139</a></span>
<span class="normal"><a href="#__codelineno-2-140">140</a></span>
<span class="normal"><a href="#__codelineno-2-141">141</a></span>
<span class="normal"><a href="#__codelineno-2-142">142</a></span>
<span class="normal"><a href="#__codelineno-2-143">143</a></span>
<span class="normal"><a href="#__codelineno-2-144">144</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50005</span><span class="p">;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">150005</span><span class="p">;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">250005</span><span class="p">;</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">650</span><span class="p">;</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Query</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">  </span><span class="n">Query</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">type</span><span class="p">),</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">  </span><span class="k">friend</span><span class="w"> </span><span class="n">istream</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">istream</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ist</span><span class="p">,</span><span class="w"> </span><span class="n">Query</span><span class="o">&amp;</span><span class="w"> </span><span class="n">qr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">    </span><span class="n">ist</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">.</span><span class="n">u</span><span class="p">;</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">qr</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">qr</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;D&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">      </span><span class="n">ist</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">.</span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ist</span><span class="p">;</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="p">};</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="n">N</span><span class="p">];</span><span class="w"> </span><span class="c1">// chỉ lưu danh sách kề đối với các đỉnh ``bé``</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="kt">int</span><span class="w"> </span><span class="n">id_big</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="kt">int</span><span class="w"> </span><span class="n">cnt_big</span><span class="p">;</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="n">bitset</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="n">adj</span><span class="p">[(</span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Q</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">];</span><span class="w"> </span><span class="c1">// còn với các đỉnh lớn, ta có thể lưu dưới dạng ma trận kề, do chỉ có &lt;= sqrt đỉnh lớn -&gt; bộ nhớ N*sqrt</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="kt">int</span><span class="w"> </span><span class="n">deg</span><span class="p">[</span><span class="n">N</span><span class="p">];</span><span class="w">  </span><span class="c1">// bậc tối đa của một đỉnh</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="n">Query</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">Q</span><span class="p">];</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="kt">int</span><span class="w"> </span><span class="n">is_online</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="kt">int</span><span class="w"> </span><span class="n">answer_for_big_nodes</span><span class="p">[</span><span class="n">N</span><span class="p">];</span><span class="w">  </span><span class="c1">// ta chỉ quan tâm đáp án của các đỉnh ``lớn``, vì có thể suy được đáp án của các đỉnh nhỏ trong O(sqrt)</span>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">is_big_node</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">deg</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">S</span><span class="p">;</span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a><span class="p">}</span>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="kt">void</span><span class="w"> </span><span class="nf">turn_on</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="w">  </span><span class="n">is_online</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt_big</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adj</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">u</span><span class="p">])</span><span class="w"> </span><span class="n">answer_for_big_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="p">}</span>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="kt">void</span><span class="w"> </span><span class="nf">turn_off</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="w">  </span><span class="n">is_online</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">cnt_big</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">adj</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">u</span><span class="p">])</span><span class="w"> </span><span class="n">answer_for_big_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a><span class="p">}</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a><span class="kt">void</span><span class="w"> </span><span class="nf">add_edge</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">is_big_node</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">is_big_node</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_big_node</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-54" name="__codelineno-2-54"></a><span class="w">    </span><span class="n">adj</span><span class="p">[</span><span class="n">id_big</span><span class="p">[</span><span class="n">v</span><span class="p">]][</span><span class="n">u</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-2-55" name="__codelineno-2-55"></a><span class="w">    </span><span class="n">answer_for_big_nodes</span><span class="p">[</span><span class="n">id_big</span><span class="p">[</span><span class="n">v</span><span class="p">]]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">is_online</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
<a id="__codelineno-2-56" name="__codelineno-2-56"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-57" name="__codelineno-2-57"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_big_node</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-58" name="__codelineno-2-58"></a><span class="w">    </span><span class="n">adj</span><span class="p">[</span><span class="n">id_big</span><span class="p">[</span><span class="n">u</span><span class="p">]][</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-2-59" name="__codelineno-2-59"></a><span class="w">    </span><span class="n">answer_for_big_nodes</span><span class="p">[</span><span class="n">id_big</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">is_online</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<a id="__codelineno-2-60" name="__codelineno-2-60"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-61" name="__codelineno-2-61"></a><span class="p">}</span>
<a id="__codelineno-2-62" name="__codelineno-2-62"></a>
<a id="__codelineno-2-63" name="__codelineno-2-63"></a><span class="kt">void</span><span class="w"> </span><span class="nf">remove_edge</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-64" name="__codelineno-2-64"></a><span class="w">  </span><span class="c1">// ta có thể erase trâu vì số lượng đỉnh kề với u tối đa là sqrt()</span>
<a id="__codelineno-2-65" name="__codelineno-2-65"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">is_big_node</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">erase</span><span class="p">(</span><span class="n">find</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">v</span><span class="p">));</span>
<a id="__codelineno-2-66" name="__codelineno-2-66"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">is_big_node</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">erase</span><span class="p">(</span><span class="n">find</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">u</span><span class="p">));</span>
<a id="__codelineno-2-67" name="__codelineno-2-67"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_big_node</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-68" name="__codelineno-2-68"></a><span class="w">    </span><span class="n">adj</span><span class="p">[</span><span class="n">id_big</span><span class="p">[</span><span class="n">v</span><span class="p">]][</span><span class="n">u</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-69" name="__codelineno-2-69"></a><span class="w">    </span><span class="n">answer_for_big_nodes</span><span class="p">[</span><span class="n">id_big</span><span class="p">[</span><span class="n">v</span><span class="p">]]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">is_online</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
<a id="__codelineno-2-70" name="__codelineno-2-70"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-71" name="__codelineno-2-71"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_big_node</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-72" name="__codelineno-2-72"></a><span class="w">    </span><span class="n">adj</span><span class="p">[</span><span class="n">id_big</span><span class="p">[</span><span class="n">u</span><span class="p">]][</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-73" name="__codelineno-2-73"></a><span class="w">    </span><span class="n">answer_for_big_nodes</span><span class="p">[</span><span class="n">id_big</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">is_online</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<a id="__codelineno-2-74" name="__codelineno-2-74"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-75" name="__codelineno-2-75"></a><span class="p">}</span>
<a id="__codelineno-2-76" name="__codelineno-2-76"></a>
<a id="__codelineno-2-77" name="__codelineno-2-77"></a><span class="kt">int</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-78" name="__codelineno-2-78"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_big_node</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-79" name="__codelineno-2-79"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">answer_for_big_nodes</span><span class="p">[</span><span class="n">id_big</span><span class="p">[</span><span class="n">u</span><span class="p">]];</span>
<a id="__codelineno-2-80" name="__codelineno-2-80"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-81" name="__codelineno-2-81"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-82" name="__codelineno-2-82"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-83" name="__codelineno-2-83"></a><span class="w">    </span><span class="n">ans</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">is_online</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<a id="__codelineno-2-84" name="__codelineno-2-84"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-85" name="__codelineno-2-85"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ans</span><span class="p">;</span>
<a id="__codelineno-2-86" name="__codelineno-2-86"></a><span class="p">}</span>
<a id="__codelineno-2-87" name="__codelineno-2-87"></a>
<a id="__codelineno-2-88" name="__codelineno-2-88"></a><span class="kt">int32_t</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-89" name="__codelineno-2-89"></a><span class="w">  </span><span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-2-90" name="__codelineno-2-90"></a><span class="w">  </span><span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-2-91" name="__codelineno-2-91"></a><span class="w">  </span><span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-2-92" name="__codelineno-2-92"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-2-93" name="__codelineno-2-93"></a><span class="w">  </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-2-94" name="__codelineno-2-94"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">o</span><span class="p">;</span>
<a id="__codelineno-2-95" name="__codelineno-2-95"></a><span class="w">  </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">o</span><span class="p">;</span>
<a id="__codelineno-2-96" name="__codelineno-2-96"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">o</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-97" name="__codelineno-2-97"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">;</span>
<a id="__codelineno-2-98" name="__codelineno-2-98"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">u</span><span class="p">;</span>
<a id="__codelineno-2-99" name="__codelineno-2-99"></a><span class="w">    </span><span class="n">is_online</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-2-100" name="__codelineno-2-100"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-101" name="__codelineno-2-101"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-102" name="__codelineno-2-102"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-2-103" name="__codelineno-2-103"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-2-104" name="__codelineno-2-104"></a><span class="w">    </span><span class="o">++</span><span class="n">deg</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
<a id="__codelineno-2-105" name="__codelineno-2-105"></a><span class="w">    </span><span class="o">++</span><span class="n">deg</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<a id="__codelineno-2-106" name="__codelineno-2-106"></a><span class="w">    </span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<a id="__codelineno-2-107" name="__codelineno-2-107"></a><span class="w">    </span><span class="n">g</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
<a id="__codelineno-2-108" name="__codelineno-2-108"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-109" name="__codelineno-2-109"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-110" name="__codelineno-2-110"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-2-111" name="__codelineno-2-111"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-112" name="__codelineno-2-112"></a><span class="w">      </span><span class="o">++</span><span class="n">deg</span><span class="p">[</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">u</span><span class="p">];</span>
<a id="__codelineno-2-113" name="__codelineno-2-113"></a><span class="w">      </span><span class="o">++</span><span class="n">deg</span><span class="p">[</span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">];</span>
<a id="__codelineno-2-114" name="__codelineno-2-114"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-115" name="__codelineno-2-115"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-116" name="__codelineno-2-116"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">u</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-117" name="__codelineno-2-117"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_big_node</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-118" name="__codelineno-2-118"></a><span class="w">      </span><span class="n">id_big</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">++</span><span class="n">cnt_big</span><span class="p">;</span>
<a id="__codelineno-2-119" name="__codelineno-2-119"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-120" name="__codelineno-2-120"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-121" name="__codelineno-2-121"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">u</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-122" name="__codelineno-2-122"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_big_node</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-123" name="__codelineno-2-123"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-124" name="__codelineno-2-124"></a><span class="w">        </span><span class="n">adj</span><span class="p">[</span><span class="n">id_big</span><span class="p">[</span><span class="n">u</span><span class="p">]][</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-2-125" name="__codelineno-2-125"></a><span class="w">        </span><span class="n">answer_for_big_nodes</span><span class="p">[</span><span class="n">id_big</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">is_online</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
<a id="__codelineno-2-126" name="__codelineno-2-126"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-2-127" name="__codelineno-2-127"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-128" name="__codelineno-2-128"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-129" name="__codelineno-2-129"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-130" name="__codelineno-2-130"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-2-131" name="__codelineno-2-131"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;O&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-132" name="__codelineno-2-132"></a><span class="w">      </span><span class="n">turn_on</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
<a id="__codelineno-2-133" name="__codelineno-2-133"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;F&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-134" name="__codelineno-2-134"></a><span class="w">      </span><span class="n">turn_off</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
<a id="__codelineno-2-135" name="__codelineno-2-135"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-136" name="__codelineno-2-136"></a><span class="w">      </span><span class="n">add_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<a id="__codelineno-2-137" name="__codelineno-2-137"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;D&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-138" name="__codelineno-2-138"></a><span class="w">      </span><span class="n">remove_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<a id="__codelineno-2-139" name="__codelineno-2-139"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-140" name="__codelineno-2-140"></a><span class="w">      </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-2-141" name="__codelineno-2-141"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-142" name="__codelineno-2-142"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-143" name="__codelineno-2-143"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-144" name="__codelineno-2-144"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<h3 id="bai-tap-ap-dung_2">Bài tập áp dụng<a class="headerlink" href="#bai-tap-ap-dung_2" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://oj.vnoi.info/problem/sqrt2_g">Educational SQRT Contest - Part 2</a>, hầu hết các bài tập trong phần này đều khai thác đến khía cạnh chia 2 cách làm cũng như chia theo truy vấn.</li>
<li><a href="https://codeforces.com/contest/1921/problem/F">1921F - Codeforces</a></li>
<li><a href="https://atcoder.jp/contests/abc335/tasks/abc335_f">ABC335 F</a></li>
<li><a href="https://oj.vnoi.info/problem/ktreec">KTREEC</a></li>
<li><a href="https://oj.vnoi.info/problem/fc100_goodarr">FC100 - GOODARR</a></li>
<li><a href="https://vn.spoj.com/problems/PATULJCI/">PATULJCI</a></li>
</ul>
<h2 id="thuat-toan-mo">Thuật toán Mo<a class="headerlink" href="#thuat-toan-mo" title="Permanent link">&para;</a></h2>
<h3 id="khong-cap-nhat">Không cập nhật<a class="headerlink" href="#khong-cap-nhat" title="Permanent link">&para;</a></h3>
<p>Đây là một thuật toán khá kinh điển, bạn đọc có thể tham khảo về lý thuyết cơ bản của nó tại tại <a href="https://vnoi.info/wiki/algo/data-structures/mo-algorithm.md">VNOI Wiki</a>. </p>
<h4 id="mo-tren-cay">Mo trên cây<a class="headerlink" href="#mo-tren-cay" title="Permanent link">&para;</a></h4>
<h5 id="truy-van-cay-con">Truy vấn cây con<a class="headerlink" href="#truy-van-cay-con" title="Permanent link">&para;</a></h5>
<p>Bạn đọc có thể tham khảo <a href="https://vnoi.info/wiki/algo/graph-theory/euler-tour-on-tree.md#c%E1%BA%ADp-nh%E1%BA%ADt-truy-v%E1%BA%A5n-%C4%91%E1%BB%91i-v%E1%BB%9Bi-%C4%91%E1%BB%89nh-v%C3%A0-c%C3%A2y-con">bài viết của VNOI</a> đã nói về vấn đề này. Cụ thể, khi ta đánh số lại các đỉnh theo Euler tour, thì khi đó cây con gốc <span class="arithmatex">\(u\)</span> sẽ thuộc một dãy liên tiếp trên mảng. Khi đó, ta có thể sắp xếp lại các truy vấn theo thuật toán Mo và thực hiện truy vấn</p>
<h5 id="truy-van-uong-i">Truy vấn đường đi<a class="headerlink" href="#truy-van-uong-i" title="Permanent link">&para;</a></h5>
<p>Bài viết về Euler tour trên <a href="https://vnoi.info/wiki/algo/graph-theory/euler-tour-on-tree.md#c%E1%BA%ADp-nh%E1%BA%ADt-%C4%91%E1%BB%89nh-truy-v%E1%BA%A5n-%C4%91%C6%B0%E1%BB%9Dng-%C4%91i">VNOI</a> đã nêu đến 3 cách đánh số lại các đỉnh để thực hiện truy vấn. Ở đây, chúng ta quan tâm đến cách số 2.</p>
<p>Cụ thể, theo đường đi Euler, ta thêm đỉnh <span class="arithmatex">\(u\)</span> vào mảng <span class="arithmatex">\(tour\)</span> khi thăm đỉnh <span class="arithmatex">\(u\)</span> lần đầu tiên và lần cuối cùng.</p>
<p>Ví dụ:</p>
<p><img alt="image" src="https://i.imgur.com/vItQSTz.png" /></p>
<p><span class="arithmatex">\(tour = [1, 2, 3, 4, 4, 3, 5, 6, 6, 5, 2, 7, 8, 8, 9, 9, 7, 1]\)</span></p>
<p>Tương tự, ta cũng gọi <span class="arithmatex">\(st_u\)</span> và <span class="arithmatex">\(en_u\)</span> lần lượt là thời điểm đầu tiên và cuối cùng gặp đỉnh <span class="arithmatex">\(u\)</span> trong mảng <span class="arithmatex">\(tour\)</span>. Mỗi đỉnh <span class="arithmatex">\(u\)</span> xuất hiện đúng 2 lần trong mảng này.</p>
<p>Giả sử ta có một truy vấn hỏi một thông tin gì đó trên đường đi <span class="arithmatex">\((u,v)\)</span>. Vậy ta sẽ lợi dụng mảng <span class="arithmatex">\(tour\)</span> thế nào để đưa về truy vấn trên đoạn liên tiếp?</p>
<details class="success">
<summary>Spoiler</summary>
<ul>
<li>Nếu <span class="arithmatex">\(u\)</span> là tổ tiên của <span class="arithmatex">\(v\)</span>, lúc này ta có <span class="arithmatex">\(st_u \leq st_v \leq en_v \leq en_u\)</span><ul>
<li>Ta không cần quan tâm đến các đỉnh có chỉ số không thuộc đoạn <span class="arithmatex">\([st_u, st_v]\)</span>, do những điểm thuộc đường đi từ <span class="arithmatex">\(u\)</span> đến <span class="arithmatex">\(v\)</span> chắc chắn thuộc đoạn này.</li>
<li>Nếu <span class="arithmatex">\(p\)</span> thuộc đường đi từ <span class="arithmatex">\(u\)</span> đến <span class="arithmatex">\(v\)</span>, nghĩa là <span class="arithmatex">\(st_u \leq st_p \leq st_v &lt; en_v\)</span>, nghĩa là <span class="arithmatex">\(p\)</span> xuất hiện duy nhất một lần trong đoạn cần xét.</li>
<li>Ngược lại, nghĩa là <span class="arithmatex">\(p\)</span> không phải là tổ tiên của <span class="arithmatex">\(v\)</span>, vậy ta có <span class="arithmatex">\(st_u&lt;st_p&lt;en_p&lt;st_v\)</span>, nghĩa là <span class="arithmatex">\(p\)</span> xuất hiện hai lần trên đoạn.</li>
<li>Vậy bài toán có thể chuyển về thành quản lý các đỉnh xuất hiện đúng 1 lần trong đoạn <span class="arithmatex">\([st_u,st_v]\)</span></li>
</ul>
</li>
<li>Nếu <span class="arithmatex">\(u\)</span> và <span class="arithmatex">\(v\)</span> thuộc hai cây con khác nhau<ul>
<li>Gọi <span class="arithmatex">\(p=lca(u,v)\)</span></li>
<li>Lúc này, đoạn chúng ta cần quan tâm là <span class="arithmatex">\([en_u, st_v] \subset [st_p,st_p]\)</span></li>
<li>Các đỉnh <span class="arithmatex">\(v'\)</span> thuộc subtree khác gốc <span class="arithmatex">\(p\)</span> mà nằm trong đoạn <span class="arithmatex">\([en_u,st_v]\)</span> thì có <span class="arithmatex">\(st_p&lt;en_u&lt;st_{p'}&lt;en_{p'}&lt;st_v\)</span> hoặc <span class="arithmatex">\(en_u&lt;st_v&lt;st_{v'}\)</span>, vậy nên chúng chỉ xuất hiện 0 hoặc 2 lần trong dãy đang xét</li>
<li>Còn các đỉnh <span class="arithmatex">\(p'\)</span> là "cha" của <span class="arithmatex">\(u\)</span> và <span class="arithmatex">\(v\)</span> và nằm trên đường đi từ <span class="arithmatex">\(u\)</span> đến <span class="arithmatex">\(v\)</span>, thì khi duyệt theo order từ <span class="arithmatex">\(en_u \rightarrow st_v\)</span>, hoặc là ta thêm điểm xuất hiện lần đầu của <span class="arithmatex">\(p'\)</span>, hoặc là thêm điểm cuối cùng xuất hiện <span class="arithmatex">\(p'\)</span>, vậy nên ta cũng chỉ xét các đỉnh này đúng một lần.</li>
<li>Đỉnh <span class="arithmatex">\(p\)</span> có thể chưa được thêm vào cấu trúc, do ta chỉ xét các đỉnh có <span class="arithmatex">\(st_p&lt;en_u&lt;st_v&lt;en_p\)</span>. Như vậy, ta cần thêm đoạn <span class="arithmatex">\([st_p,st_p]\)</span></li>
<li>Kết luận, ta chỉ cần xét những đỉnh xuất hiện duy nhất một lần trong đoạn cần quan tâm.</li>
</ul>
</li>
</ul>
</details>
<h5 id="bai-toan-ap-dung">Bài toán áp dụng<a class="headerlink" href="#bai-toan-ap-dung" title="Permanent link">&para;</a></h5>
<ul>
<li><a href="http://www.spoj.com/problems/COT2/">COT2 - SPOJ</a> - <a href="https://ideone.com/6NVoPD">triển khai mẫu</a></li>
<li><a href="https://codeforces.com/gym/100962/attachments/download/4255/20152016-petrozavodsk-winter-training-camp-moscow-su-trinity-contest-en.pdf">Frank Sinatra - Prob.F</a></li>
<li><a href="https://www.codechef.com/ALKH2016/problems/VLB">Vasya and Little Bear - Codechef</a></li>
<li><a href="https://codeforces.com/contest/852/problem/I">Dating</a></li>
</ul>
<h4 id="mot-so-thu-thuat-toi-uu">Một số thủ thuật tối ưu<a class="headerlink" href="#mot-so-thu-thuat-toi-uu" title="Permanent link">&para;</a></h4>
<h5 id="mot-cach-sap-xep-truy-van-khac">Một cách sắp xếp truy vấn khác<a class="headerlink" href="#mot-cach-sap-xep-truy-van-khac" title="Permanent link">&para;</a></h5>
<p>Đây là một cách sắp xếp các truy vấn để giảm độ phức tạp từ <span class="arithmatex">\(O((n+q) \times \sqrt{n})\)</span> xuống <span class="arithmatex">\(O(n \times \sqrt{q})\)</span>, sử dụng Hilbert Curve. Các bạn có thể tham khảo bài viết <a href="https://codeforces.com/b\log/entry/61203">sau</a> để hiểu rõ hơn về tư tưởng.</p>
<h5 id="khu-log">Khử <span class="arithmatex">\(\log\)</span><a class="headerlink" href="#khu-log" title="Permanent link">&para;</a></h5>
<p>Xét bài toán: Cho mảng <span class="arithmatex">\(A\)</span> gồm <span class="arithmatex">\(n\)</span> phần tử và <span class="arithmatex">\(q\)</span> truy vấn, mỗi truy vấn yêu cầu tìm <span class="arithmatex">\(mex(a_l, \cdots, a_r)\)</span>. Bài toán này có thể giải offline trong <span class="arithmatex">\(O(q\log(n))\)</span> hoặc online với các cấu trúc persistent, tuy nhiên những cách giải này sẽ không được xét đến trong phạm vi blog này, mà ta sẽ xét cách làm sử dụng thuật toán Mo:</p>
<ul>
<li>Sắp xếp các truy vấn theo thuật toán Mo</li>
<li>Duy trì một set <span class="arithmatex">\(S\)</span> thể hiện các phần tử chưa xuất hiện trong mảng. Ban đầu <span class="arithmatex">\(S\)</span> chứa các phần tử từ <span class="arithmatex">\(0 \rightarrow n\)</span> do giá trị mex tối đa của ta chỉ là <span class="arithmatex">\(n\)</span> nên ta cũng chỉ quan tâm đến đó</li>
<li>Bằng set <span class="arithmatex">\(S\)</span> này, với mỗi truy vấn ta có thể thêm/xoá phần tử trong <span class="arithmatex">\(O(\log(n))\)</span> và tìm min trong <span class="arithmatex">\(O(\log(n))\)</span></li>
</ul>
<p>Độ phức tạp của cách làm này là <span class="arithmatex">\(O(n \sqrt{n} \log(n))\)</span>, quá chậm và chậm hơn nữa khi ta sử dụng <code>std::set</code>. Có cách làm khác sử dụng hash table, tuy nhiên constant của nó cũng khá cao và không phù hợp với các bài toán cần truy xuất một lượng lớn các truy vấn thêm/xoá phần tử như bài toán này.</p>
<p>Ta xét một cấu trúc dữ liệu cho phép:</p>
<ul>
<li>Chèn/xoá phần tử trong <span class="arithmatex">\(O(1)\)</span></li>
<li>Tìm mex trong <span class="arithmatex">\(O(\sqrt{n})\)</span></li>
</ul>
<p><em>Sau tất cả, mình lại trở về với nhau...</em></p>
<p>Đúng vậy, ta lại quay về việc chia block như ban đầu. Nhận thấy ta có thể lưu mảng <span class="arithmatex">\(cnt_x\)</span> là các phần tử có giá trị bằng <span class="arithmatex">\(x\)</span>. Với mỗi truy vấn tìm <span class="arithmatex">\(mex\)</span>, ta duyệt <span class="arithmatex">\(x\)</span> từ <span class="arithmatex">\(0\)</span> đến <span class="arithmatex">\(n\)</span>, và dừng lại khi gặp <span class="arithmatex">\(cnt_x=0\)</span>. Tuy nhiên việc làm này quá lâu, ta sẽ tối ưu lại bằng phương pháp chia block như sau:</p>
<ul>
<li>Chia mảng <span class="arithmatex">\(cnt\)</span> thành <span class="arithmatex">\(\sqrt{n}\)</span> khối. Với mỗi khối ta lưu <span class="arithmatex">\(cntB_i\)</span> là số lượng phần tử phân biệt xuất hiện trên khối thứ <span class="arithmatex">\(i\)</span></li>
<li>Với mỗi truy vấn thêm <span class="arithmatex">\(x\)</span>, ta tăng <span class="arithmatex">\(cnt_x\)</span> lên <span class="arithmatex">\(1\)</span> và <span class="arithmatex">\(cntB_{\frac{x}{\sqrt{N}}}\)</span> lên 1 nếu <span class="arithmatex">\(cnt_x=1\)</span>. Tương tự với truy vấn xoá.</li>
<li>Với mỗi truy vấn tìm mex, ta duyệt các khối và tìm khối <span class="arithmatex">\(i\)</span> đầu tiên có <span class="arithmatex">\(cntB_i \neq \sqrt{n}\)</span>. Sau đó ta duyệt các phần tử <span class="arithmatex">\(j\)</span> thuộc khối <span class="arithmatex">\(i\)</span>, và tìm <span class="arithmatex">\(j\)</span> đầu tiên có <span class="arithmatex">\(cnt_j=0\)</span>. Ta có <span class="arithmatex">\(\sqrt{n}\)</span> khối, mỗi khối có <span class="arithmatex">\(\sqrt{n}\)</span> phần tử. Vậy độ phức tạp cho phần này là <span class="arithmatex">\(O(\sqrt{n})\)</span></li>
</ul>
<p>Như vậy là ta giải quyết xong bài toán này trong <span class="arithmatex">\(O((n+q) \times \sqrt{n})\)</span></p>
<p>Bạn đọc có thể cài đặt thử tại link: <a href="https://codeforces.com/contest/1000/problem/F">1000F - Codeforces</a></p>
<h3 id="co-cap-nhat">Có cập nhật<a class="headerlink" href="#co-cap-nhat" title="Permanent link">&para;</a></h3>
<h4 id="vi-du_3">Ví dụ<a class="headerlink" href="#vi-du_3" title="Permanent link">&para;</a></h4>
<p><a href="https://codeforces.com/contest/940/problem/F">940F Codeforces</a></p>
<details class="question">
<summary>Đề bài</summary>
<p>Xử lí 2 loại truy vấn:</p>
<ul>
<li>Gán <span class="arithmatex">\(a_i=x\)</span></li>
<li>Cho 2 số <span class="arithmatex">\(l,r\)</span>. Gọi <span class="arithmatex">\(cnt_i\)</span> là số lượng số có giá trị bằng <span class="arithmatex">\(i\)</span> trong đoạn <span class="arithmatex">\([l,r]\)</span>. Tìm <span class="arithmatex">\(mex(cnt_0, \cdots, cnt_{10^9})\)</span></li>
</ul>
</details>
<details class="success">
<summary>Lời giải</summary>
<p>Ta sẽ tách riêng hai loại truy vấn gán và hỏi. Với mỗi truy vấn hỏi, ta biểu diễn nó dưới dạng <span class="arithmatex">\((t,l,r)\)</span> với <span class="arithmatex">\(t\)</span> là số lượng truy vấn gán trước nó. Ngược lại, ta biểu diễn dưới dạng <span class="arithmatex">\((i,x)\)</span> - như đề bài đã cho.</p>
<p>Đặt <span class="arithmatex">\(P=n^{\frac{2}{3}}\)</span>. Lúc này, ta có thể chia mảng <span class="arithmatex">\(a\)</span> thành <span class="arithmatex">\(\frac{n}{P}=n^{\frac{1}{3}}\)</span> đoạn. Vậy mỗi cặp <span class="arithmatex">\((l,r)\)</span> có thể thuộc tối đa <span class="arithmatex">\(P\)</span> cặp đoạn (do mỗi biến <span class="arithmatex">\(l\)</span> và <span class="arithmatex">\(r\)</span> có thể thuộc <span class="arithmatex">\(\frac{n}{P}\)</span> đoạn riêng biệt)</p>
<p>Ta xét tất cả các cặp khối <span class="arithmatex">\((b_l,b_r)\)</span> có thể xảy ra. Với mỗi cặp khối:</p>
<ul>
<li>Ta duyệt các bộ <span class="arithmatex">\((t,l,r)\)</span> với <span class="arithmatex">\(\frac{l}{P}=b_l\)</span> và <span class="arithmatex">\(\frac{r}{P}=b_r\)</span> theo thứ tự tăng dần của <span class="arithmatex">\(t\)</span>. </li>
<li>Cũng như thuật toán Mo, ta duy trì hai biến <span class="arithmatex">\(cur_l,cur_r\)</span> thể hiện hai biên hiện tại tính đến truy vấn đang xét. Với mỗi truy vấn xét đến, ta tiến hành tăng giảm <span class="arithmatex">\(cur_l,cur_r\)</span> và cập nhật <span class="arithmatex">\(a_{cur_l},a_{cur_r}\)</span> vào cấu trúc dữ liệu, tương tự như khi thực hiện thuật toán Mo thông thường. </li>
<li>Tuy nhiên, ta vẫn chưa xét các thao tác update. Ta lưu thêm một biến <span class="arithmatex">\(cur_t\)</span> thể hiện xem ta đã duyệt đến truy vấn update thứ bao nhiêu. Trong khi <span class="arithmatex">\(cur_t&lt;t\)</span>, ta tiến hành cập nhật vào mảng <span class="arithmatex">\(a\)</span> nghĩa là gán <span class="arithmatex">\(a_i=x\)</span>, và thay đổi cấu trúc dữ liệu nếu <span class="arithmatex">\(cur_l \leq i \leq cur_r\)</span></li>
</ul>
<p>Vì <span class="arithmatex">\(q \approx n\)</span>, nên khi đánh giá độ phức tạp, ta coi như <span class="arithmatex">\(q=n\)</span>.</p>
<p>Ta có <span class="arithmatex">\((\frac{n}{P})^2=n^{\frac{2}{3}}\)</span> cặp <span class="arithmatex">\((b_l,b_r)\)</span> cần xét. Với các biên <span class="arithmatex">\((cur_l,cur_r)\)</span>, ta chỉ di chuyền chúng trong khối <span class="arithmatex">\(b_l\)</span> và <span class="arithmatex">\(b_r\)</span>, vậy số bước di chuyển tối đa là <span class="arithmatex">\(n^{\frac{2}{3}}\)</span>, và ta có <span class="arithmatex">\(n\)</span> truy vấn, nên số bước di chuyển là <span class="arithmatex">\(n \times P=n^{\frac{5}{3}}\)</span>. Biến <span class="arithmatex">\(t\)</span> thay đổi tối đa <span class="arithmatex">\(n\)</span> lần với mỗi cặp <span class="arithmatex">\(b\)</span>, nên có <span class="arithmatex">\(n \times (\frac{n}{P})^2 = n^{\frac{5}{3}}\)</span> lần duyệt <span class="arithmatex">\(t\)</span>. Vậy độ phức tạp tổng có thể xem là <span class="arithmatex">\(O(n^{\frac{5}{3}})\)</span></p>
<p>Đến đây việc còn lại chỉ là tìm mex. Bằng việc sử dụng thủ thuật được nêu ở phần trên, ta có thể tìm mex trong <span class="arithmatex">\(O(\sqrt{n})\)</span>, do đáp án tối đa là <span class="arithmatex">\(n\)</span>. Tuy nhiên, ta cũng có thể rút ra một cận chặt hơn là đáp án của chúng ta <span class="arithmatex">\(\leq 2\sqrt{n}\)</span>. Do để mex bằng <span class="arithmatex">\(c\)</span> thì ít nhất ta phải có ít nhất một số xuất hiện <span class="arithmatex">\(1\)</span> lần, một số xuất hiện <span class="arithmatex">\(2\)</span> lần, <span class="arithmatex">\(\cdots\)</span>, một số xuất hiện <span class="arithmatex">\(c-1\)</span> lần. Vậy ta cần có ít nhất <span class="arithmatex">\(1+2+\cdots+c-1=\frac{c(c-1)}{2}\)</span> số trong đoạn đang xét. Mà đoạn dài nhất tối đa là <span class="arithmatex">\(n\)</span> <span class="arithmatex">\(\rightarrow \frac{c(c-1)}{2} \leq n \rightarrow c \leq 2\sqrt{n}\)</span>. Như vậy muốn tìm mex ta chỉ cần duyệt trâu là AC, vì tối đa chỉ có <span class="arithmatex">\(q\)</span> truy vấn.</p>
</details>
<details class="abstract">
<summary>Cài đặt</summary>
<p><a href="https://codeforces.com/contest/940/submission/122177453">https://codeforces.com/contest/940/submission/122177453</a></p>
</details>
<h4 id="bai-tap-ap-dung_3">Bài tập áp dụng<a class="headerlink" href="#bai-tap-ap-dung_3" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="https://www.codechef.com/FEB17/problems/DISTNUM3">Primitive Queries</a></li>
<li><a href="http://uoj.ac/problem/58?locale=en">Candy Park</a></li>
</ul>
<h2 id="xau">Xâu<a class="headerlink" href="#xau" title="Permanent link">&para;</a></h2>
<h3 id="gioi-thieu_1">Giới thiệu<a class="headerlink" href="#gioi-thieu_1" title="Permanent link">&para;</a></h3>
<p>Cho dãy <span class="arithmatex">\(a\)</span> có <span class="arithmatex">\(n\)</span> phần tử nguyên không âm và <span class="arithmatex">\(a_1+a_2+\cdots+a_n=m\)</span>. Nhận xét: số lượng phần tử phân biệt của dãy <span class="arithmatex">\(a\)</span> <span class="arithmatex">\(\leq \sqrt{m}\)</span> </p>
<details class="success">
<summary>Chứng minh</summary>
<ul>
<li>Gọi <span class="arithmatex">\(b_0,\cdots,b_{k-1}\)</span> là dãy <span class="arithmatex">\(a\)</span> sau khi được sort unique</li>
<li>Vì <span class="arithmatex">\(b_i\)</span> nguyên không âm <span class="arithmatex">\(\Rightarrow b_i \geq i\)</span> <span class="arithmatex">\(\Rightarrow \sum_{i=0}^{k-1}b_i \geq \sum_{i=0}^{k-1}i=\frac{k(k-1)}{2}\)</span></li>
<li>Lại có <span class="arithmatex">\(b_0+\cdots+b_{k-1} \leq m \Rightarrow \frac{k(k-1)}{2} \leq m \Rightarrow k \leq \sqrt{m}\)</span></li>
</ul>
</details>
<h3 id="vi-du_4">Ví dụ<a class="headerlink" href="#vi-du_4" title="Permanent link">&para;</a></h3>
<p><a href="https://oj.vnoi.info/problem/olp_sc22_bstr">Olympic Sinh Viên 2022 - Siêu cúp - Tìm xâu đẹp</a></p>
<details class="question">
<summary>Đề bài</summary>
<p>Xử lí các truy vấn</p>
<ul>
<li>Thêm xâu <span class="arithmatex">\(S\)</span> vào tập</li>
<li>Xoá xâu <span class="arithmatex">\(S\)</span> khỏi tập</li>
<li>Đếm số xâu trong tập chứa <span class="arithmatex">\(S\)</span> như một xâu con</li>
</ul>
<p>Đặt <span class="arithmatex">\(T =\)</span> tổng độ dài các xâu <span class="arithmatex">\(S\)</span>. Ta có <span class="arithmatex">\(T \leq 5 \times 10^5\)</span> </p>
</details>
<details class="success">
<summary>Lời giải</summary>
<p>Bằng một số thuật toán Automation hoặc chia hai cách làm ta cũng có thể giải được bài này. Tuy nhiên từ nhận xét trên ta có thể rút ra thuật toán sau đây:</p>
<ul>
<li>Chỉ có <span class="arithmatex">\(\sqrt{T}\)</span> độ dài phân biệt của <span class="arithmatex">\(S\)</span>. Lưu các độ dài này vào một mảng <span class="arithmatex">\(L\)</span></li>
<li>Với mỗi truy vấn thêm hoặc xoá xâu <span class="arithmatex">\(S\)</span>, ta duyệt mọi độ dài <span class="arithmatex">\(len\)</span> trong <span class="arithmatex">\(L\)</span>, và sử dụng một cấu trúc dữ liệu để ghi nhận số lần xuất hiện của mọi xâu con phân biệt độ dài <span class="arithmatex">\(len\)</span> của <span class="arithmatex">\(S\)</span> </li>
<li>Với mỗi truy vấn hỏi, ta truy xuất trong cấu trúc dữ liệu để ra được đáp án</li>
<li>Ta có thể dùng Hash kết hợp với chặt nhị phân để làm việc này. Cụ thể, ta lưu mã Hash của toàn bộ truy vấn xâu <span class="arithmatex">\(S\)</span> vào một mảng <span class="arithmatex">\(H\)</span>. Sau đó, ta sắp xếp mảng <span class="arithmatex">\(H\)</span> này lại. Khi thêm/bớt một xâu, ta chặt nhị phân mã hash của nó trên <span class="arithmatex">\(H\)</span>. Nếu tồn tại, giả sử vị trí của nó trên <span class="arithmatex">\(H\)</span> là <span class="arithmatex">\(P\)</span>, ta sử dụng mảng đếm <span class="arithmatex">\(cnt\)</span> và tiến hành truy xuất <span class="arithmatex">\(cnt_P\)</span>.</li>
<li>Ngoài cách sử dụng Hash, ta cũng có thể sử dụng cấu trúc dữ liệu Trie để lưu trữ các xâu.</li>
</ul>
<p>Độ phức tạp sẽ là <span class="arithmatex">\(O(Q\sqrt{T})\)</span>. Dù độ phức tạp rất lớn nhưng trên thực tế không có nhiều độ dài đến vậy, nên vẫn có thể AC.</p>
</details>
<details class="abstract">
<summary>Cài đặt</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span>
<span class="normal"><a href="#__codelineno-3-29">29</a></span>
<span class="normal"><a href="#__codelineno-3-30">30</a></span>
<span class="normal"><a href="#__codelineno-3-31">31</a></span>
<span class="normal"><a href="#__codelineno-3-32">32</a></span>
<span class="normal"><a href="#__codelineno-3-33">33</a></span>
<span class="normal"><a href="#__codelineno-3-34">34</a></span>
<span class="normal"><a href="#__codelineno-3-35">35</a></span>
<span class="normal"><a href="#__codelineno-3-36">36</a></span>
<span class="normal"><a href="#__codelineno-3-37">37</a></span>
<span class="normal"><a href="#__codelineno-3-38">38</a></span>
<span class="normal"><a href="#__codelineno-3-39">39</a></span>
<span class="normal"><a href="#__codelineno-3-40">40</a></span>
<span class="normal"><a href="#__codelineno-3-41">41</a></span>
<span class="normal"><a href="#__codelineno-3-42">42</a></span>
<span class="normal"><a href="#__codelineno-3-43">43</a></span>
<span class="normal"><a href="#__codelineno-3-44">44</a></span>
<span class="normal"><a href="#__codelineno-3-45">45</a></span>
<span class="normal"><a href="#__codelineno-3-46">46</a></span>
<span class="normal"><a href="#__codelineno-3-47">47</a></span>
<span class="normal"><a href="#__codelineno-3-48">48</a></span>
<span class="normal"><a href="#__codelineno-3-49">49</a></span>
<span class="normal"><a href="#__codelineno-3-50">50</a></span>
<span class="normal"><a href="#__codelineno-3-51">51</a></span>
<span class="normal"><a href="#__codelineno-3-52">52</a></span>
<span class="normal"><a href="#__codelineno-3-53">53</a></span>
<span class="normal"><a href="#__codelineno-3-54">54</a></span>
<span class="normal"><a href="#__codelineno-3-55">55</a></span>
<span class="normal"><a href="#__codelineno-3-56">56</a></span>
<span class="normal"><a href="#__codelineno-3-57">57</a></span>
<span class="normal"><a href="#__codelineno-3-58">58</a></span>
<span class="normal"><a href="#__codelineno-3-59">59</a></span>
<span class="normal"><a href="#__codelineno-3-60">60</a></span>
<span class="normal"><a href="#__codelineno-3-61">61</a></span>
<span class="normal"><a href="#__codelineno-3-62">62</a></span>
<span class="normal"><a href="#__codelineno-3-63">63</a></span>
<span class="normal"><a href="#__codelineno-3-64">64</a></span>
<span class="normal"><a href="#__codelineno-3-65">65</a></span>
<span class="normal"><a href="#__codelineno-3-66">66</a></span>
<span class="normal"><a href="#__codelineno-3-67">67</a></span>
<span class="normal"><a href="#__codelineno-3-68">68</a></span>
<span class="normal"><a href="#__codelineno-3-69">69</a></span>
<span class="normal"><a href="#__codelineno-3-70">70</a></span>
<span class="normal"><a href="#__codelineno-3-71">71</a></span>
<span class="normal"><a href="#__codelineno-3-72">72</a></span>
<span class="normal"><a href="#__codelineno-3-73">73</a></span>
<span class="normal"><a href="#__codelineno-3-74">74</a></span>
<span class="normal"><a href="#__codelineno-3-75">75</a></span>
<span class="normal"><a href="#__codelineno-3-76">76</a></span>
<span class="normal"><a href="#__codelineno-3-77">77</a></span>
<span class="normal"><a href="#__codelineno-3-78">78</a></span>
<span class="normal"><a href="#__codelineno-3-79">79</a></span>
<span class="normal"><a href="#__codelineno-3-80">80</a></span>
<span class="normal"><a href="#__codelineno-3-81">81</a></span>
<span class="normal"><a href="#__codelineno-3-82">82</a></span>
<span class="normal"><a href="#__codelineno-3-83">83</a></span>
<span class="normal"><a href="#__codelineno-3-84">84</a></span>
<span class="normal"><a href="#__codelineno-3-85">85</a></span>
<span class="normal"><a href="#__codelineno-3-86">86</a></span>
<span class="normal"><a href="#__codelineno-3-87">87</a></span>
<span class="normal"><a href="#__codelineno-3-88">88</a></span>
<span class="normal"><a href="#__codelineno-3-89">89</a></span>
<span class="normal"><a href="#__codelineno-3-90">90</a></span>
<span class="normal"><a href="#__codelineno-3-91">91</a></span>
<span class="normal"><a href="#__codelineno-3-92">92</a></span>
<span class="normal"><a href="#__codelineno-3-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5e5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BASE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">311</span><span class="p">;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Query</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">  </span><span class="n">string</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">  </span><span class="n">Query</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="p">};</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="kt">void</span><span class="w"> </span><span class="n">sort_and_unique</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">  </span><span class="n">sort</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="w">  </span><span class="n">v</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="p">}</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="kt">int64_t</span><span class="w"> </span><span class="n">power</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="kt">int64_t</span><span class="w"> </span><span class="n">cur_hash</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="kt">int</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="kt">int</span><span class="w"> </span><span class="n">vis</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="kt">int64_t</span><span class="w"> </span><span class="nf">get_hash</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">cur_hash</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cur_hash</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">power</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="p">}</span>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="kt">int32_t</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="w">  </span><span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="w">  </span><span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="w">  </span><span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="w">  </span><span class="n">power</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-3-33" name="__codelineno-3-33"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="w">    </span><span class="n">power</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">BASE</span><span class="p">;</span>
<a id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-3-36" name="__codelineno-3-36"></a><span class="w">  </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Query</span><span class="o">&gt;</span><span class="w"> </span><span class="n">qr</span><span class="p">;</span>
<a id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<a id="__codelineno-3-38" name="__codelineno-3-38"></a><span class="w">  </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<a id="__codelineno-3-39" name="__codelineno-3-39"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-3-41" name="__codelineno-3-41"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="w">    </span><span class="n">qr</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="s">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">});</span>
<a id="__codelineno-3-43" name="__codelineno-3-43"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-3-44" name="__codelineno-3-44"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-3-45" name="__codelineno-3-45"></a><span class="w">  </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<a id="__codelineno-3-46" name="__codelineno-3-46"></a><span class="w">  </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">len_query</span><span class="p">;</span>
<a id="__codelineno-3-47" name="__codelineno-3-47"></a><span class="w">  </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">hash_query</span><span class="p">;</span>
<a id="__codelineno-3-48" name="__codelineno-3-48"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-49" name="__codelineno-3-49"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">ask</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-3-50" name="__codelineno-3-50"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ask</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-3-51" name="__codelineno-3-51"></a><span class="w">    </span><span class="n">qr</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">ask</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">});</span>
<a id="__codelineno-3-52" name="__codelineno-3-52"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ask</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;q&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-53" name="__codelineno-3-53"></a><span class="w">      </span><span class="n">len_query</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<a id="__codelineno-3-54" name="__codelineno-3-54"></a><span class="w">      </span><span class="n">hash_query</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-3-55" name="__codelineno-3-55"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-56" name="__codelineno-3-56"></a><span class="w">        </span><span class="n">hash_query</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hash_query</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">BASE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-3-57" name="__codelineno-3-57"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-3-58" name="__codelineno-3-58"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-59" name="__codelineno-3-59"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-3-60" name="__codelineno-3-60"></a><span class="w">  </span><span class="n">sort_and_unique</span><span class="p">(</span><span class="n">len_query</span><span class="p">);</span>
<a id="__codelineno-3-61" name="__codelineno-3-61"></a><span class="w">  </span><span class="n">sort_and_unique</span><span class="p">(</span><span class="n">hash_query</span><span class="p">);</span>
<a id="__codelineno-3-62" name="__codelineno-3-62"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">timer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-3-63" name="__codelineno-3-63"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">delta</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-64" name="__codelineno-3-64"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-65" name="__codelineno-3-65"></a><span class="w">      </span><span class="n">cur_hash</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur_hash</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">BASE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-3-66" name="__codelineno-3-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-67" name="__codelineno-3-67"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">len_query</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-68" name="__codelineno-3-68"></a><span class="w">      </span><span class="o">++</span><span class="n">timer</span><span class="p">;</span>
<a id="__codelineno-3-69" name="__codelineno-3-69"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-70" name="__codelineno-3-70"></a><span class="w">        </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">cur_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_hash</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-3-71" name="__codelineno-3-71"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lower_bound</span><span class="p">(</span><span class="n">hash_query</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">hash_query</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">cur_val</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hash_query</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<a id="__codelineno-3-72" name="__codelineno-3-72"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">hash_query</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">hash_query</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">cur_val</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">vis</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">timer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-73" name="__codelineno-3-73"></a><span class="w">          </span><span class="n">vis</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timer</span><span class="p">;</span>
<a id="__codelineno-3-74" name="__codelineno-3-74"></a><span class="w">          </span><span class="n">cnt</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">delta</span><span class="p">;</span>
<a id="__codelineno-3-75" name="__codelineno-3-75"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-3-76" name="__codelineno-3-76"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-3-77" name="__codelineno-3-77"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-78" name="__codelineno-3-78"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-3-79" name="__codelineno-3-79"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">qr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-80" name="__codelineno-3-80"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;q&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-81" name="__codelineno-3-81"></a><span class="w">      </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-3-82" name="__codelineno-3-82"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-83" name="__codelineno-3-83"></a><span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">BASE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-3-84" name="__codelineno-3-84"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-3-85" name="__codelineno-3-85"></a><span class="w">      </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">hash_query</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">hash_query</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hash_query</span><span class="p">.</span><span class="n">begin</span><span class="p">()]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-3-86" name="__codelineno-3-86"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;i&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-87" name="__codelineno-3-87"></a><span class="w">      </span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-3-88" name="__codelineno-3-88"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-89" name="__codelineno-3-89"></a><span class="w">      </span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
<a id="__codelineno-3-90" name="__codelineno-3-90"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-91" name="__codelineno-3-91"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-3-92" name="__codelineno-3-92"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-3-93" name="__codelineno-3-93"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p><a href="https://oj.vnoi.info/problem/bedao_r16_d">Bedao R16 - Domino</a></p>
<details class="question">
<summary>Đề bài</summary>
<p>Cho <span class="arithmatex">\(n\)</span> domino có mặt trên là <span class="arithmatex">\(a_i\)</span>, mặt dưới là <span class="arithmatex">\(b_i\)</span>. Tìm cách flip một số domino sao cho chênh lệch giữa tổng mặt trên và tổng mặt dưới là nhỏ nhất có thể. <span class="arithmatex">\(n \leq 10^5; a_i, b_i \leq 6\)</span></p>
</details>
<details class="success">
<summary>Lời giải</summary>
<p>Nhận xét mỗi domino ta chỉ tác động tối đa 1 lần. Và khi biết được tổng mặt trên, ta dễ dàng suy ra được tổng mặt dưới bằng cách lấy tổng <span class="arithmatex">\(a_i+b_i\)</span> rồi trừ đi.</p>
<p>Đến đây ta có hướng đi dp knapsack: Gọi <span class="arithmatex">\(F(i,s)=0/1\)</span> khi xét đến vị trí <span class="arithmatex">\(i\)</span> và ta tạo được tổng <span class="arithmatex">\(s\)</span>. Dễ thấy công thức sẽ là <span class="arithmatex">\(F(i,s)=F(i-1,s-a_i)||F(i-1,s-b_i)\)</span>. Tuy nhiên làm như vậy độ phức tạp là <span class="arithmatex">\(O(n^2)\)</span> do <span class="arithmatex">\(max(s)=n \times 6\)</span></p>
<p>Nhìn lại bài toán. Giả sử ban đầu ta có <span class="arithmatex">\(a_i \leq b_i \ \forall i\)</span> (nếu không có điều kiện này thì ta có thể flip luôn từ khi đọc input). Ban đầu chênh lệch của ta là <span class="arithmatex">\(|\sum_{i=1}^{n} a_i-b_i|\)</span>. Khi tác động lên domino thứ <span class="arithmatex">\(i\)</span>, ta được cộng vào đáp án một lượng là <span class="arithmatex">\(b_i-a_i\)</span>. Vậy ta có thể coi bài toán như là có <span class="arithmatex">\(n\)</span> vật giá trị <span class="arithmatex">\(b_i-a_i\)</span>, ta cần quy hoạch động tìm một dãy có tổng xác định để chênh lệch đạt giá trị nhỏ nhất.</p>
<p>Vì <span class="arithmatex">\(b_i-a_i \leq 6\)</span>. Ta có thể duy trì mảng <span class="arithmatex">\(cnt_i\)</span> là số vật có giá trị <span class="arithmatex">\(b_i-a_i\)</span>. Sau đó ta có thể quy hoạch động <span class="arithmatex">\(F(i,s)\)</span> là xét đến vật có giá trị <span class="arithmatex">\(i\)</span> và đạt được tổng <span class="arithmatex">\(s\)</span>. Dễ thu nhận được <span class="arithmatex">\(F(i,s)=F(i-1,s-c \times i) \ \forall c \in [0,cnt_i]\)</span>. Tuy nhiên làm như vậy độ phức tạp vẫn là <span class="arithmatex">\(O(n^2)\)</span></p>
<p>Ta sẽ dùng một trick như sau: </p>
<ul>
<li>Giả sử có các vật với giá trị <span class="arithmatex">\(i\)</span> và số lượng <span class="arithmatex">\(cnt_i\)</span></li>
<li>Gọi <span class="arithmatex">\(k\)</span> là số lớn nhất thoả mãn: <span class="arithmatex">\(2^0+2^1+⋯+2^k=2^{k+1}-1 \leq cnt_i (1)\)</span>. Dễ thấy <span class="arithmatex">\(k \leq \log_2(cnt_i)\)</span></li>
<li>Khi đó ta chia thành các vật nhỏ hơn với giá trị là <span class="arithmatex">\(2^0,\cdots,2^k\)</span>; thêm một vật nữa nếu như <span class="arithmatex">\(cnt_i-2^{k+1}+1&gt;0\)</span>. Ta sẽ chứng minh bằng cách chọn một tập con của các vật mới tách ra này, ta luôn có thể tạo ra các số nguyên thuộc <span class="arithmatex">\([0,cnt_i]\)</span></li>
<li>Bằng cách chọn một tập con của <span class="arithmatex">\([0,k]\)</span>, ta có thể tạo được các số thuộc <span class="arithmatex">\([0,2^{k+1})\)</span> </li>
<li>Còn thừa lại <span class="arithmatex">\(x=cnt_i-2^{k+1}+1\)</span>, ta cần chứng minh rằng có thể tạo được tập <span class="arithmatex">\([2^{k+1},cnt_i]\)</span></li>
<li>Dễ thấy với các số thuộc <span class="arithmatex">\([0,2^{k+1})\)</span> , khi ta cộng thêm <span class="arithmatex">\(x\)</span>, sẽ tạo được các số thuộc <span class="arithmatex">\([x,x+2^{k+1}-1]\)</span></li>
<li>Vì <span class="arithmatex">\(k\)</span> là số lớn nhất thoả mãn <span class="arithmatex">\((1)\)</span> nên <span class="arithmatex">\(x \leq 2^{k+1}-1\)</span></li>
<li><span class="arithmatex">\(x \leq 2^{k+1}-1 \leq cnt_i = x+2^{k+1}-1→[2^{k+1},cnt_i ] \subset [x,x+2^{k+1}-1]\)</span></li>
<li>Như vậy ta có thể tạo được các số thuộc <span class="arithmatex">\([0,cnt_i]\)</span></li>
</ul>
<p>Bằng nhận xét ở phần giới thiệu, ta cũng có thể rút ra được số lượng phần tử phân biệt trong dãy mới là <span class="arithmatex">\(\leq \sqrt{6 \times n}\)</span>. Việc quy hoạch động trên dãy mới cho ta thuật toán với độ phức tạp là <span class="arithmatex">\(O(n\sqrt{n})\)</span>. Phần truy vết xin dành cho bạn đọc.</p>
</details>
<details class="abstract">
<summary>Cài đặt</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span>
<span class="normal"><a href="#__codelineno-4-35">35</a></span>
<span class="normal"><a href="#__codelineno-4-36">36</a></span>
<span class="normal"><a href="#__codelineno-4-37">37</a></span>
<span class="normal"><a href="#__codelineno-4-38">38</a></span>
<span class="normal"><a href="#__codelineno-4-39">39</a></span>
<span class="normal"><a href="#__codelineno-4-40">40</a></span>
<span class="normal"><a href="#__codelineno-4-41">41</a></span>
<span class="normal"><a href="#__codelineno-4-42">42</a></span>
<span class="normal"><a href="#__codelineno-4-43">43</a></span>
<span class="normal"><a href="#__codelineno-4-44">44</a></span>
<span class="normal"><a href="#__codelineno-4-45">45</a></span>
<span class="normal"><a href="#__codelineno-4-46">46</a></span>
<span class="normal"><a href="#__codelineno-4-47">47</a></span>
<span class="normal"><a href="#__codelineno-4-48">48</a></span>
<span class="normal"><a href="#__codelineno-4-49">49</a></span>
<span class="normal"><a href="#__codelineno-4-50">50</a></span>
<span class="normal"><a href="#__codelineno-4-51">51</a></span>
<span class="normal"><a href="#__codelineno-4-52">52</a></span>
<span class="normal"><a href="#__codelineno-4-53">53</a></span>
<span class="normal"><a href="#__codelineno-4-54">54</a></span>
<span class="normal"><a href="#__codelineno-4-55">55</a></span>
<span class="normal"><a href="#__codelineno-4-56">56</a></span>
<span class="normal"><a href="#__codelineno-4-57">57</a></span>
<span class="normal"><a href="#__codelineno-4-58">58</a></span>
<span class="normal"><a href="#__codelineno-4-59">59</a></span>
<span class="normal"><a href="#__codelineno-4-60">60</a></span>
<span class="normal"><a href="#__codelineno-4-61">61</a></span>
<span class="normal"><a href="#__codelineno-4-62">62</a></span>
<span class="normal"><a href="#__codelineno-4-63">63</a></span>
<span class="normal"><a href="#__codelineno-4-64">64</a></span>
<span class="normal"><a href="#__codelineno-4-65">65</a></span>
<span class="normal"><a href="#__codelineno-4-66">66</a></span>
<span class="normal"><a href="#__codelineno-4-67">67</a></span>
<span class="normal"><a href="#__codelineno-4-68">68</a></span>
<span class="normal"><a href="#__codelineno-4-69">69</a></span>
<span class="normal"><a href="#__codelineno-4-70">70</a></span>
<span class="normal"><a href="#__codelineno-4-71">71</a></span>
<span class="normal"><a href="#__codelineno-4-72">72</a></span>
<span class="normal"><a href="#__codelineno-4-73">73</a></span>
<span class="normal"><a href="#__codelineno-4-74">74</a></span>
<span class="normal"><a href="#__codelineno-4-75">75</a></span>
<span class="normal"><a href="#__codelineno-4-76">76</a></span>
<span class="normal"><a href="#__codelineno-4-77">77</a></span>
<span class="normal"><a href="#__codelineno-4-78">78</a></span>
<span class="normal"><a href="#__codelineno-4-79">79</a></span>
<span class="normal"><a href="#__codelineno-4-80">80</a></span>
<span class="normal"><a href="#__codelineno-4-81">81</a></span>
<span class="normal"><a href="#__codelineno-4-82">82</a></span>
<span class="normal"><a href="#__codelineno-4-83">83</a></span>
<span class="normal"><a href="#__codelineno-4-84">84</a></span>
<span class="normal"><a href="#__codelineno-4-85">85</a></span>
<span class="normal"><a href="#__codelineno-4-86">86</a></span>
<span class="normal"><a href="#__codelineno-4-87">87</a></span>
<span class="normal"><a href="#__codelineno-4-88">88</a></span>
<span class="normal"><a href="#__codelineno-4-89">89</a></span>
<span class="normal"><a href="#__codelineno-4-90">90</a></span>
<span class="normal"><a href="#__codelineno-4-91">91</a></span>
<span class="normal"><a href="#__codelineno-4-92">92</a></span>
<span class="normal"><a href="#__codelineno-4-93">93</a></span>
<span class="normal"><a href="#__codelineno-4-94">94</a></span>
<span class="normal"><a href="#__codelineno-4-95">95</a></span>
<span class="normal"><a href="#__codelineno-4-96">96</a></span>
<span class="normal"><a href="#__codelineno-4-97">97</a></span>
<span class="normal"><a href="#__codelineno-4-98">98</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MAX_N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MAX_TYPE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="kt">int</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">MAX_N</span><span class="p">];</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="kt">int</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">MAX_N</span><span class="p">];</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">MAX_N</span><span class="p">];</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="kt">int</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="n">MAX_N</span><span class="p">];</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="kt">int</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="mi">6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAX_N</span><span class="p">];</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bucket</span><span class="p">[</span><span class="n">MAX_TYPE</span><span class="p">];</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="kt">int</span><span class="w"> </span><span class="n">ansCnt</span><span class="p">[</span><span class="n">MAX_N</span><span class="p">];</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="kt">bool</span><span class="w"> </span><span class="n">flipped</span><span class="p">[</span><span class="n">MAX_N</span><span class="p">];</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="w">  </span><span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="w">  </span><span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="w">  </span><span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="cp">#define task &quot;a&quot;</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fopen</span><span class="p">(</span><span class="n">task</span><span class="w"> </span><span class="s">&quot;.inp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a><span class="w">    </span><span class="n">freopen</span><span class="p">(</span><span class="n">task</span><span class="w"> </span><span class="s">&quot;.inp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stdin</span><span class="p">);</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a><span class="w">    </span><span class="n">freopen</span><span class="p">(</span><span class="n">task</span><span class="w"> </span><span class="s">&quot;.out&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stdout</span><span class="p">);</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a><span class="w">  </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-35" name="__codelineno-4-35"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-36" name="__codelineno-4-36"></a><span class="w">      </span><span class="n">flipped</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-4-37" name="__codelineno-4-37"></a><span class="w">      </span><span class="n">swap</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-4-38" name="__codelineno-4-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-39" name="__codelineno-4-39"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-4-40" name="__codelineno-4-40"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-41" name="__codelineno-4-41"></a><span class="w">    </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-4-42" name="__codelineno-4-42"></a><span class="w">    </span><span class="n">bucket</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-4-43" name="__codelineno-4-43"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-4-44" name="__codelineno-4-44"></a><span class="w">  </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">;</span>
<a id="__codelineno-4-45" name="__codelineno-4-45"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="o">++</span><span class="n">cnt</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
<a id="__codelineno-4-46" name="__codelineno-4-46"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-47" name="__codelineno-4-47"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-4-48" name="__codelineno-4-48"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">l</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-49" name="__codelineno-4-49"></a><span class="w">      </span><span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">l</span><span class="p">;</span>
<a id="__codelineno-4-50" name="__codelineno-4-50"></a><span class="w">      </span><span class="n">items</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-4-51" name="__codelineno-4-51"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-52" name="__codelineno-4-52"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="n">items</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-4-53" name="__codelineno-4-53"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-4-54" name="__codelineno-4-54"></a><span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3f</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">F</span><span class="p">));</span>
<a id="__codelineno-4-55" name="__codelineno-4-55"></a><span class="w">  </span><span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-4-56" name="__codelineno-4-56"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">maxSum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<a id="__codelineno-4-57" name="__codelineno-4-57"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-4-58" name="__codelineno-4-58"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxSum</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-59" name="__codelineno-4-59"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-60" name="__codelineno-4-60"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">first</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">items</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">first</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-61" name="__codelineno-4-61"></a><span class="w">        </span><span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<a id="__codelineno-4-62" name="__codelineno-4-62"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-4-63" name="__codelineno-4-63"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-4-64" name="__codelineno-4-64"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-65" name="__codelineno-4-65"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-4-66" name="__codelineno-4-66"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">trace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-67" name="__codelineno-4-67"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-68" name="__codelineno-4-68"></a><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">sum</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-4-69" name="__codelineno-4-69"></a><span class="w">      </span><span class="n">ansCnt</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span><span class="p">;</span>
<a id="__codelineno-4-70" name="__codelineno-4-70"></a><span class="w">      </span><span class="n">sum</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">;</span>
<a id="__codelineno-4-71" name="__codelineno-4-71"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-72" name="__codelineno-4-72"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-4-73" name="__codelineno-4-73"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ansSum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-4-74" name="__codelineno-4-74"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2e9</span><span class="p">;</span>
<a id="__codelineno-4-75" name="__codelineno-4-75"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">S1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-4-76" name="__codelineno-4-76"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">S1</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-4-77" name="__codelineno-4-77"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxSum</span><span class="p">;</span><span class="w"> </span><span class="n">sum</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-78" name="__codelineno-4-78"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">F</span><span class="p">[</span><span class="n">sum</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mh">0x3f3f3f3f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-79" name="__codelineno-4-79"></a><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">cur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">S1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum</span><span class="p">);</span>
<a id="__codelineno-4-80" name="__codelineno-4-80"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">best</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">cur</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-81" name="__codelineno-4-81"></a><span class="w">        </span><span class="n">best</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur</span><span class="p">,</span><span class="w"> </span><span class="n">ansSum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">;</span>
<a id="__codelineno-4-82" name="__codelineno-4-82"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-4-83" name="__codelineno-4-83"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-84" name="__codelineno-4-84"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-4-85" name="__codelineno-4-85"></a><span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="n">ansSum</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
<a id="__codelineno-4-86" name="__codelineno-4-86"></a><span class="w">  </span><span class="n">trace</span><span class="p">(</span><span class="n">ansSum</span><span class="p">);</span>
<a id="__codelineno-4-87" name="__codelineno-4-87"></a><span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-4-88" name="__codelineno-4-88"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-89" name="__codelineno-4-89"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ansCnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-90" name="__codelineno-4-90"></a><span class="w">      </span><span class="n">flipped</span><span class="p">[</span><span class="n">bucket</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">back</span><span class="p">()]</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-4-91" name="__codelineno-4-91"></a><span class="w">      </span><span class="n">bucket</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pop_back</span><span class="p">();</span>
<a id="__codelineno-4-92" name="__codelineno-4-92"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-93" name="__codelineno-4-93"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-4-94" name="__codelineno-4-94"></a><span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">flipped</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">flipped</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span>
<a id="__codelineno-4-95" name="__codelineno-4-95"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-4-96" name="__codelineno-4-96"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">flipped</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span>
<a id="__codelineno-4-97" name="__codelineno-4-97"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-4-98" name="__codelineno-4-98"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<h3 id="bai-tap-ap-dung_4">Bài tập áp dụng<a class="headerlink" href="#bai-tap-ap-dung_4" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="http://www.usaco.org/index.php?page=viewproblem2&amp;cpid=1259&amp;lang=en">Strongest Friendship Group - USACO Gold 2022</a></li>
</ul>
<h2 id="baby-step-giant-step">Baby step giant step<a class="headerlink" href="#baby-step-giant-step" title="Permanent link">&para;</a></h2>
<h3 id="gioi-thieu_2">Giới thiệu<a class="headerlink" href="#gioi-thieu_2" title="Permanent link">&para;</a></h3>
<p>Xét phương trình: <span class="arithmatex">\(a^x \equiv b \ (\mod m)\)</span>, với giả thiết <span class="arithmatex">\(\gcd(a,m)=1\)</span>. Ta cần tìm một nghiệm <span class="arithmatex">\(x\)</span> thoả mãn phương trình trên.</p>
<ul>
<li>Nhận xét: sau tối đa <span class="arithmatex">\(m\)</span> bước thì sẽ gặp lại một giá trị <span class="arithmatex">\(a^i\)</span> đã thăm trước đó. Vì theo nguyên lí Dirichlet, nếu ta có <span class="arithmatex">\(m\)</span> số giá trị <span class="arithmatex">\(&lt;m\)</span>, thì ít nhất có 2 số có giá trị bằng nhau. Vì vậy thử các giá trị <span class="arithmatex">\(x&gt;m\)</span> là vô nghĩa.
<img alt="image" src="https://i.imgur.com/WaHGRvq.png" /></li>
<li>Vậy cách giải trâu ở đây sẽ là duyệt <span class="arithmatex">\(x\)</span> từ <span class="arithmatex">\(0\)</span> đến <span class="arithmatex">\(m\)</span>, và kiểm tra <span class="arithmatex">\(a^x\)</span> có thoả mãn điều kiện đề bài không. Nhưng như vậy không đủ để giải với <span class="arithmatex">\(m\)</span> lớn.</li>
<li>Đặt <span class="arithmatex">\(x=Tp+q\)</span>, với <span class="arithmatex">\(T\)</span> là một hằng số xác định. Cách chọn <span class="arithmatex">\(T\)</span> sẽ được trình bày sau. Ở đây <span class="arithmatex">\(p\)</span> được gọi là "giant step", còn <span class="arithmatex">\(q\)</span> được gọi là "baby step"</li>
<li>Khi đó phương trình trở thành <span class="arithmatex">\(a^{Tp+q} \equiv b (\mod m)\)</span></li>
<li>Phương trình tương đương <span class="arithmatex">\(a^{Tp} \equiv a^{-q} \times b (\mod m)\)</span></li>
<li>Ta có thể tính <span class="arithmatex">\(a^{Tp}\)</span> với mọi giá trị <span class="arithmatex">\(p \in [0,\lfloor \frac{m}{T}\rfloor]\)</span> và <span class="arithmatex">\(a^{-q} \times b\)</span> với mọi giá trị <span class="arithmatex">\(q&lt;T\)</span>. Sau đó, ta có thể sử dụng chặt nhị phân để đếm số cặp giá trị bằng nhau trên hai mảng trên.</li>
</ul>
<p>Độ phức tạp phụ thuộc vào <span class="arithmatex">\(\frac{m}{T} + T\)</span>. Như đã đề cập ở các phần trước, biểu thức này đạt giá trị nhỏ nhất khi <span class="arithmatex">\(T=\sqrt{m}\)</span>.</p>
<p>Thuật toán trên không chỉ giới hạn ở mức giải phương trình, mà ta có thể áp dụng cho bất cứ cyclic group độ dài <span class="arithmatex">\(n\)</span> nào mà tồn tại inverse của chúng.</p>
<h3 id="vi-du_5">Ví dụ<a class="headerlink" href="#vi-du_5" title="Permanent link">&para;</a></h3>
<p><a href="https://codeforces.com/contest/1840/problem/G1">1840G1 - Codeforces</a></p>
<details class="success">
<summary>Lời giải</summary>
<ul>
<li>Để tìm <span class="arithmatex">\(n\)</span> cách đơn giản nhất là duyệt <span class="arithmatex">\(10^6\)</span> lần từ vị trí xuất phát được cho ban đầu đến khi gặp lại số đã đi qua. Độ dài chu trình đó chính là <span class="arithmatex">\(n\)</span>. Tuy nhiên làm vậy sẽ bị quá số câu hỏi.</li>
<li>Chọn một số <span class="arithmatex">\(K\)</span> bất kì. Hỏi <span class="arithmatex">\(K\)</span> câu hỏi <span class="arithmatex">\(+1\)</span> để tìm <span class="arithmatex">\(K\)</span> số đầu tiên. Nếu <span class="arithmatex">\(N&lt;K\)</span>, sẽ có 2 số trùng nhau trong <span class="arithmatex">\(K\)</span> số đầu tiên được thăm. Vậy <span class="arithmatex">\(N\)</span> sẽ là khoảng cách giữa 2 số trùng nhau đó.</li>
<li>Ngược lại, <span class="arithmatex">\(N \geq K\)</span>. Ta chia vòng tròn làm <span class="arithmatex">\(\frac{N}{K}\)</span> cung nhỏ. Bắt đầu từ vị trí hiện tại, ta nhảy <span class="arithmatex">\(K\)</span> bước một qua từng cung, nghĩa là hỏi các câu hỏi <span class="arithmatex">\(+K\)</span> để tìm số ở vị trí <span class="arithmatex">\(2K,3K,...\)</span>. Nếu như quay lại cung chứa số đã được đánh dấu <span class="arithmatex">\(\Rightarrow\)</span> số đó đã được đánh dấu ở <span class="arithmatex">\(K\)</span> bước đầu <span class="arithmatex">\(\Rightarrow\)</span> tìm lại được <span class="arithmatex">\(N\)</span>.</li>
<li>Độ phức tạp: <span class="arithmatex">\(O(K+\frac{N}{K})\)</span>. Để tối ưu số câu hỏi ta cần tìm <span class="arithmatex">\(K\)</span> sao cho <span class="arithmatex">\(K+\frac{N}{K}\)</span> min. Theo Cosi ta có <span class="arithmatex">\(K+\frac{N}{K} \geq 2 \times \sqrt{K \times \frac{N}{K}} = 2 \sqrt {N}\)</span>. Dấu bằng xảy ra khi <span class="arithmatex">\(K=\frac{N}{K} \Leftrightarrow K = \sqrt{N}\)</span>. Vậy số câu hỏi cần dùng tối đa là <span class="arithmatex">\(2000\)</span> câu.</li>
</ul>
</details>
<details class="abstract">
<summary>Cài đặt</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span>
<span class="normal"><a href="#__codelineno-5-30">30</a></span>
<span class="normal"><a href="#__codelineno-5-31">31</a></span>
<span class="normal"><a href="#__codelineno-5-32">32</a></span>
<span class="normal"><a href="#__codelineno-5-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">marked</span><span class="p">[</span><span class="mi">1000005</span><span class="p">];</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="n">marked</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">marked</span><span class="p">));</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">  </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">  </span><span class="n">marked</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;+ 1&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">marked</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">      </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;! &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">marked</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="w">    </span><span class="n">marked</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1001000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;+ 1000&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="w">    </span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">marked</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="w">      </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;! &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">marked</span><span class="p">[</span><span class="n">p</span><span class="p">])</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<h3 id="bai-tap-ap-dung_5">Bài tập áp dụng<a class="headerlink" href="#bai-tap-ap-dung_5" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://www.spoj.com/problems/MOD/">SPOJ - MOD</a></li>
<li><a href="https://community.topcoder.com/stat?c=problem_statement&amp;pm=14386&amp;rd=16801">TopCoder - SplitingFoxes3</a></li>
<li><a href="https://www.codechef.com/problems/INVXOR/">Codechef - INVXOR</a></li>
<li><a href="https://codeforces.com/gym/101853/problem/G">Codeforces - Hard equation</a> - bài toán yêu cầu giải <span class="arithmatex">\(a^x \equiv b\)</span> nhưng không với điều kiện <span class="arithmatex">\(gcd(a,m)=1\)</span>. Gợi ý: ta có thể đổi biến <span class="arithmatex">\(a'=ga,b'=gb,m'=gm\)</span> với <span class="arithmatex">\(g=gcd(a,m)\)</span>.</li>
<li><a href="https://www.codechef.com/problems/CHEFMOD">Codechef - CHEFMOD</a></li>
</ul>
<h2 id="tai-lieu-tham-khao">Tài liệu tham khảo<a class="headerlink" href="#tai-lieu-tham-khao" title="Permanent link">&para;</a></h2>
<ul>
<li>Toàn bộ các hình ảnh trong bài viết: <a href="https://imgur.com/a/IbeUDPM">imgur</a></li>
<li><a href="http://acm.math.spbu.ru/~sk1/mm/lections/mipt2016-sqrt/mipt-2016-burunduk1-sqrt.en.pdf">MIPT Spring Camp 2016</a></li>
<li><a href="https://cp-algorithms.com/algebra/discrete-log.html">Discrete log - CP-Algorithm</a></li>
<li><a href="https://vnoi.info/wiki/algo/data-structures/sqrt-decomposition.md">Chia căn - VNOI Wiki</a></li>
<li><a href="https://www.wikiwand.com/en/Baby-step_giant-step">Baby step giant step - Wikiwand</a></li>
<li><a href="https://codeforces.com/blog/entry/100910">Collection of little techniques - Codeforces</a></li>
<li><a href="https://codeforces.com/blog/entry/61203">An alternative sorting order for Mo's algorithm - Codeforces</a></li>
<li><a href="https://codeforces.com/blog/entry/96713">Sqrt decomposition - Errichto</a></li>
<li><a href="https://mamnoonsiam.github.io/dump/sqrt-decomp.html">SQRT Decomposition Problems - Codeforces</a></li>
<li><a href="https://usaco.guide/plat/sqrt?lang=cpp#set-a">USACO - Sqrt Decomposition</a></li>
<li><a href="https://codeforces.com/blog/entry/43230">Mo's Algorithm on Trees [Tutorial] - Codeforces</a></li>
<li><a href="https://codeforces.com/blog/entry/72690">Mo's Algorithm (with update and without update, now you can understand both) - Codeforces</a></li>
<li><a href="https://ei1333.hateblo.jp/entry/2017/09/11/211011">ei1333's blog</a></li>
<li><a href="https://kazuma8128.hatenablog.com/entry/2018/03/16/225926">kazuma8128's blog</a></li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 <a href="https://github.com/lto5"  target="_blank" rel="noopener">Le Tuan</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/letuano5" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://facebook.com/letuano5" target="_blank" rel="noopener" title="facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.instant", "navigation.path", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.select", "content.code.copy", "navigation.instant", "navigation.instant.prefetch", "toc.follow"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>